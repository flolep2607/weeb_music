"use strict";function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function _createClass(t,i,e){return i&&_defineProperties(t.prototype,i),e&&_defineProperties(t,e),t}!function(a,h){var t=function(){function s(t,i,e){_classCallCheck(this,s),(this.audio=i).addEventListener("seek",this.resetEffects.bind(this)),e.addEventListener("newsong",this.resetEffects.bind(this)),e.addEventListener("newimage",this.setImage.bind(this)),e.addEventListener("newcolour",this.setColour.bind(this)),e.addEventListener("beat",this.beat.bind(this)),e.addEventListener("invert",this.setInvert.bind(this)),e.addEventListener("settingsupdated",this.settingsUpdated.bind(this)),e.addEventListener("frame",this.animationLoop.bind(this)),this.core=e,this.needsRedraw=!1,this.colour=16777215,this.image=null,this.smartAlign=!0,this.animTimeout=null,this.animFrame=null,this.lastBeat=0,this.blurDecay=null,this.blurAmount=null,this.blurIterations=null,this.blurDelta=null,this.blurAlpha=null,this.blurStart=0,this.blurDistance=0,this.xBlur=!1,this.yBlur=!1,this.sliceDistance=0,this.sliceStart=0,this.slices={x:this.makeSliceObj(25),y:this.makeSliceObj(15)},this.trippyStart=[0,0],this.trippyRadii=[0,0],this.trippyOn=!1,this.trippyRadius=0,this.blackout=!1,this.blackoutColour="#000",this.blackoutTimeout=null,this.lastBlackout=0,this.currentBlackout=-1,this.lastFrameBlack=!1,this.invert=!1,this.colourFade=!1,this.colourFadeStart=0,this.colourFadeLength=0,this.oldColour=16777215,this.newColour=16777215,this.blendMode="hard-light",this.setBlurAmount("medium"),this.setBlurQuality("high"),this.setBlurDecay("fast"),this.canvas=h.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=1280,this.canvas.height=720,this.canvas.className="hues-canvas",t.appendChild(this.canvas),this.offCanvas=h.createElement("canvas"),this.offContext=this.offCanvas.getContext("2d"),a.addEventListener("resize",this.resize.bind(this)),this.resize()}return _createClass(s,[{key:"makeSliceObj",value:function(t){return{count:0,avgSegments:t,segments:[],distances:[]}}},{key:"setInvert",value:function(t){this.invert=t,this.needsRedraw=!0}},{key:"settingsUpdated",value:function(){this.setSmartAlign(this.core.settings.smartAlign),this.setBlurAmount(this.core.settings.blurAmount),this.setBlurDecay(this.core.settings.blurDecay),this.setBlurQuality(this.core.settings.blurQuality),this.trippyOn="on"==this.core.settings.trippyMode}},{key:"resetEffects",value:function(){this.colourFadeStart=0,this.colourFade=!1,this.trippyStart=[0,0],this.sliceStart=0,this.blurStart=0,this.blurDistance=0,this.xBlur=!1,this.yBlur=!1}},{key:"resize",value:function(){var t=this.core.root.clientHeight,i=this.core.root.clientWidth/t;this.canvas.height=Math.min(t,720),this.canvas.width=Math.ceil(this.canvas.height*i),this.offCanvas.height=this.canvas.height,this.offCanvas.width=this.canvas.width,this.trippyRadius=Math.max(this.canvas.width,this.canvas.height)/2,this.needsRedraw=!0}},{key:"redraw",value:function(){var t,i,e=this.canvas.width,s=this.canvas.height,a=this.audio.currentTime;if(this.context.globalAlpha=1,this.context.globalCompositeOperation="source-over",this.blackout){if(1<(i=10*(a-this.blackoutStart))){if(this.lastBlackout==this.currentBlackout||!this.lastFrameBlack)return this.lastFrameBlack=!0,this.lastBlackout=this.currentBlackout,this.context.fillStyle=this.blackoutColour,this.context.fillRect(0,0,e,s),this.needsRedraw=!1,void this.drawInvert();this.lastFrameBlack=!1,this.context.fillStyle="#FFF",this.context.fillRect(0,0,e,s)}}else this.lastFrameBlack=!1,this.context.fillStyle="#FFF",this.context.fillRect(0,0,e,s);if(this.image&&(this.image.bitmap||this.image.bitmaps)){var h=this.image.animated?this.image.bitmaps[this.animFrame]:this.image.bitmap,a=h.height*(s/h.height),r=h.width/h.height*a;if(this.smartAlign)switch(this.image.align){case"left":t=0;break;case"right":t=e-r;break;default:t=e/2-r/2}else t=e/2-r/2;this.sliceStart&&(h=this.drawSlice(h,r,a,e,s),r=e,a=s),this.xBlur||this.yBlur?this.drawBlur(h,t,r,a):(this.context.globalAlpha=1,this.context.drawImage(h,t,0,r,a))}this.trippyStart[0]||this.trippyStart[1]?this.drawTrippy(e,s):(this.offContext.fillStyle=this.intToHex(this.colour),this.offContext.fillRect(0,0,e,s)),this.context.globalAlpha=.7,this.context.globalCompositeOperation=this.blendMode,this.context.drawImage(this.offCanvas,0,0),this.blackout?(this.context.globalAlpha=i,this.context.fillStyle=this.blackoutColour,this.context.fillRect(0,0,e,s),this.needsRedraw=!0):this.needsRedraw=!1,this.drawInvert()}},{key:"drawInvert",value:function(){this.invert&&(this.context.globalAlpha=1,this.context.globalCompositeOperation="difference",this.context.fillStyle="#FFF",this.context.fillRect(0,0,this.canvas.width,this.canvas.height))}},{key:"drawSlice",value:function(t,i,e,s,a){this.offContext.clearRect(0,0,s,a);for(var h=0,r=0,n=0;n<this.slices.x.count;n++){for(var l=this.slices.x.segments[n],o=this.slices.x.distances[n]*this.sliceDistance,u=Math.ceil(l*t.width),c=Math.ceil(l*i),d=0,m=0,f=0;f<this.slices.y.count;f++){var p=this.slices.y.segments[f],b=this.slices.y.distances[f]*this.sliceDistance,g=Math.ceil(p*t.height),p=Math.ceil(p*e);this.offContext.drawImage(t,h,d,u,g,r+b,m+o,c,p),d+=g,m+=p}h+=u,r+=c}return this.offCanvas}},{key:"drawBlur",value:function(t,i,e,s){if(this.context.globalAlpha=this.blurAlpha,this.xBlur)if(this.blurIterations<0)this.context.globalAlpha=1,this.context.drawImage(t,Math.floor(i-this.blurDistance/2),0,e+this.blurDistance,s);else for(var a=-1;a<=1;a+=this.blurDelta)this.context.drawImage(t,Math.floor(this.blurDistance*a)+i,0,e,s);else if(this.yBlur)if(this.blurIterations<0)this.context.globalAlpha=1,this.context.drawImage(t,i,Math.floor(-this.blurDistance/2),e,s+this.blurDistance);else for(var h=-1;h<=1;h+=this.blurDelta)this.context.drawImage(t,i,Math.floor(this.blurDistance*h),e,s)}},{key:"drawTrippy",value:function(t,i){var e=this.trippyStart[1]>this.trippyStart[0],s=this.intToHex(16777215^this.colour),a=this.intToHex(this.colour);this.offContext.fillStyle=e?s:a,this.offContext.fillRect(0,0,t,i),this.trippyRadii.sort(function(t,i){return i-t});for(var h=!e,r=0;r<2;r++)0!==this.trippyRadii[r]&&(this.offContext.beginPath(),this.offContext.fillStyle=this.intToHex(h?s:a),this.offContext.arc(t/2,i/2,this.trippyRadii[r],0,2*Math.PI,!1),this.offContext.fill(),this.offContext.closePath(),h=!h)}},{key:"intToHex",value:function(t){return"#"+("00000"+t.toString(16)).slice(-6)}},{key:"animationLoop",value:function(){var t,i,e,s;this.colourFade&&(1<=(t=(this.audio.currentTime-this.colourFadeStart)/this.colourFadeLength)?(this.stopFade(),this.colour=this.newColour):this.mixColours(t),this.needsRedraw=!0),this.blackoutTimeout&&this.audio.currentTime>this.blackoutTimeout&&this.clearBlackout(),this.image&&this.image.animated&&(this.image.beatsPerAnim&&this.core.currentSong&&this.core.currentSong.charsPerBeat?(t=this.animFrame,this.syncAnim(),this.animFrame!=t&&(this.needsRedraw=!0,this.animTimeout=this.audio.currentTime)):this.animTimeout<this.audio.currentTime&&(this.animFrame++,this.animFrame%=this.image.frameDurations.length,this.animTimeout+=this.image.frameDurations[this.animFrame]/1e3,this.needsRedraw=!0)),this.blurStart&&(e=this.audio.currentTime-this.blurStart+1/30,this.blurDistance=this.blurAmount*Math.exp(-this.blurDecay*e),e=this.blurDistance/this.blurAmount,this.xBlur?this.core.blurUpdated(e,0):this.core.blurUpdated(0,e)),this.sliceStart&&((e=this.audio.currentTime)<this.sliceRampUp?(i=this.sliceRampUp-e,this.sliceDistance=.8*(1-i/this.sliceTransitionTime)):e<this.sliceRampDown?(i=this.sliceRampDown-e,s=this.sliceRampDown-this.sliceRampUp,this.sliceDistance=.8+(1-i/s)*(1-.8)):(s=this.sliceRampDown+this.sliceTransitionTime)<e?(this.sliceStart=0,this.sliceDistance=0):(i=s-e,this.sliceDistance=i/this.sliceTransitionTime),this.needsRedraw=!0);for(var a=0;a<2;a++)(this.trippyStart[a]||this.trippyRadii[a])&&(this.needsRedraw=!0,this.trippyRadii[a]=2*Math.floor((this.audio.currentTime-this.trippyStart[a])*this.trippyRadius),this.trippyRadii[a]>this.trippyRadius?(this.trippyStart[a]=0,this.trippyRadii[a]=0):a%2==0&&(this.trippyRadii[a]=this.trippyRadius-this.trippyRadii[a]));this.blurStart&&this.blurDistance<1?(this.core.blurUpdated(0,0),this.blurDistance=0,this.blurStart=0,this.xBlur=this.yBlur=!1,this.redraw()):(this.blurStart||this.needsRedraw)&&this.redraw()}},{key:"setImage",value:function(t){this.image!=t&&(this.needsRedraw=!0,(this.image=t)&&(t.bitmap||t.bitmaps)&&t.animated&&(this.animBeat=null,this.animFrame=0,this.animTimeout=this.audio.currentTime+t.frameDurations[0]/1e3,t.beatsPerAnim&&this.core.currentSong&&this.core.currentSong.charsPerBeat&&this.syncAnim()))}},{key:"beat",value:function(){this.lastBeat=this.audio.currentTime}},{key:"syncAnim",value:function(){var t,i,e=this.core.currentSong;e&&(i=this.core.beatIndex,this.lastBeat&&this.core.getBeatLength()&&(t=(this.audio.currentTime-this.lastBeat)/this.core.getBeatLength(),i+=Math.min(t,1)),i=i/e.charsPerBeat%this.image.beatsPerAnim,e=this.image.bitmaps.length,this.animFrame=Math.floor(e*(i/this.image.beatsPerAnim)),this.image.syncOffset&&(this.animFrame+=this.image.syncOffset),this.animFrame=(this.animFrame%e+e)%e)}},{key:"setColour",value:function(t,i){t.c!=this.colour&&(i?this.newColour=t.c:(this.stopFade(),this.colour=t.c),this.needsRedraw=!0)}},{key:"doBlackout",value:function(t){void 0===t&&(t=!1),this.blackoutColour=t?"#FFF":"#000",this.blackoutTimeout=0,this.blackout||(this.blackoutStart=this.audio.currentTime),this.blackout=!0,this.needsRedraw=!0,"on"==this.core.settings.blackoutUI&&this.core.userInterface.hide()}},{key:"clearBlackout",value:function(){this.blackout=!1,this.blackoutTimeout=0,this.needsRedraw=!0,"on"==this.core.settings.blackoutUI&&this.core.userInterface.show()}},{key:"doShortBlackout",value:function(t){this.doInstantBlackout(),this.blackoutTimeout=this.audio.currentTime+t/1.7,this.currentBlackout++}},{key:"doInstantBlackout",value:function(){this.doBlackout(),this.blackoutStart=-Math.pow(2,32)}},{key:"doColourFade",value:function(t){this.colourFade=!0,this.colourFadeLength=t,this.colourFadeStart=this.audio.currentTime,this.oldColour=this.colour}},{key:"stopFade",value:function(){this.colourFade=!1,this.colourFadeStart=0,this.colourFadeLength=0}},{key:"mixColours",value:function(t){t=Math.min(1,t);var i=this.oldColour>>16&255,e=this.oldColour>>8&255,s=255&this.oldColour,i=i*(1-t)+(this.newColour>>16&255)*t,e=e*(1-t)+(this.newColour>>8&255)*t,t=s*(1-t)+(255&this.newColour)*t;this.colour=i<<16|e<<8|t}},{key:"doXBlur",value:function(){this.blurStart=this.audio.currentTime,this.trippyOn&&(this.trippyStart[0]=this.blurStart),this.blurDistance=this.blurAmount,this.xBlur=!0,this.yBlur=!1,this.needsRedraw=!0}},{key:"doYBlur",value:function(){this.blurStart=this.audio.currentTime,this.trippyOn&&(this.trippyStart[1]=this.blurStart),this.blurDistance=this.blurAmount,this.xBlur=!1,this.yBlur=!0,this.needsRedraw=!0}},{key:"doTrippyX",value:function(){var t=this.trippyOn;this.trippyOn=!0,this.doXBlur(),this.trippyOn=t}},{key:"doTrippyY",value:function(){var t=this.trippyOn;this.trippyOn=!0,this.doYBlur(),this.trippyOn=t}},{key:"doSlice",value:function(t,i,e,s){var a=Math.min(.06,t);this.sliceStart=this.audio.currentTime,this.sliceRampUp=this.sliceStart+a,this.sliceRampDown=this.sliceStart+t*i-a,this.sliceTransitionTime=a,e?this.generateSliceSegments("x"):this.resetSliceSegments("x"),s?this.generateSliceSegments("y"):this.resetSliceSegments("y"),this.needsRedraw=!0}},{key:"generateSliceSegments",value:function(t){for(var i=1/this.slices[t].avgSegments,e=i/2,s=0,a=0;;a++){var h=i+Math.random()*e*2-e;if(s+=this.slices[t].segments[a]=h,this.slices[t].distances[a]=Math.random()*this.blurAmount-this.blurAmount/2,1<s){this.slices[t].segments[a]-=s-1;break}}this.slices[t].count=a+1}},{key:"resetSliceSegments",value:function(t){this.slices[t].count=1,this.slices[t].segments[0]=1,this.slices[t].distances[0]=0}},{key:"setBlurDecay",value:function(t){this.blurDecay={slow:7.8,medium:14.1,fast:20.8,"faster!":28.7}[t]}},{key:"setBlurQuality",value:function(t){this.blurIterations={low:-1,medium:11,high:19,extreme:35}[t],this.blurDelta=1/(this.blurIterations/2),this.blurAlpha=1/(this.blurIterations/2)}},{key:"setBlurAmount",value:function(t){this.blurAmount={low:48,medium:96,high:384}[t]}},{key:"setSmartAlign",value:function(t){this.smartAlign="on"==t}}]),s}();a.HuesCanvas=t}(window,document);
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}!function(n,s){var e=function(){function t(e){var r=this;_classCallCheck(this,t),this.eventListeners={loaded:[],time:[],blurupdate:[],newsong:[],newimage:[],newcolour:[],newmode:[],beat:[],invert:[],frame:[],songstarted:[],settingsupdated:[]},this.version=35,this.versionStr=(this.version/10).toFixed(1),this.versionHex=this.version.toString(16),this.beatIndex=0,this.buildLength=-1,this.loopLength=-1,this.currentSong=null,this.currentImage=null,this.songIndex=-1,this.imageIndex=-1,this.lastSongArray=[],this.lastImageArray=[],this.colourIndex=63,this.colours=t.oldColours,this.invert=!1,this.loopCount=0,this.doBuildup=!0,this.userInterface=null,this.uiArray=[],this.settings=new HuesSettings(e),zip.workerScriptsPath=this.settings.workersPath,this.root=null,this.settings.root?"string"==typeof this.settings.root?this.settings.root&&s.getElementById(this.settings.root)?this.root=s.getElementById(this.settings.root):this.root=s.body:this.root=this.settings.root:this.root=s.body,this.root.classList.add("hues-root"),this.root===s.body&&(s.documentElement.className="hues-root"),this.root.innerHTML="",this.makePreloader(this.root),n.onerror=function(e,t,n,s,i){return r.error(e),!1},this.window=new HuesWindow(this.root,this.settings),console.log("0x40 Hues v"+this.versionStr+" - start your engines!"),this.resourceManager=new Resources(this,this.window),this.editor=new HuesEditor(this,this.window),this.settings.initUI(this.window),populateHuesInfo(this.versionStr,this.window,this.settings),this.window.selectTab(this.settings.firstWindow,!0);e=s.createElement("div");e.className="hues-ui",this.root.appendChild(e),this.uiArray.push(new RetroUI(e),new WeedUI(e),new ModernUI(e),new XmasUI(e),new HalloweenUI(e),new MinimalUI(e)),this.autoSong=this.settings.autoSong,this.visualiser=s.createElement("canvas"),this.visualiser.className="hues-visualiser",this.visualiser.height="64",this.vCtx=this.visualiser.getContext("2d"),this.soundManager=new SoundManager(this,this.settings.volume),this.soundManager.init().then(function(){return r.soundManager.locked||"on"!=r.settings.skipPreloader?r.resourceManager.getSizes(r.settings.respacks):null}).then(function(e){if(null!==e){e=e.reduce(function(e,t){return"number"==typeof t?e+t:null},0),e=(e="number"==typeof e?e.toFixed(1):'<abbr title="Content-Length header not present for respack URLs">???</abbr>')+"MB of music/images.<br />Flashing lights.<br /><b>Tap or click to start</b>";return r.soundManager.locked||(e+="<br /><span>Skip this screen from Options</span>"),r.warning(e),r.soundManager.unlock()}}).then(function(){return r.clearMessage(),setInterval(r.loopCheck.bind(r),1e3),r.renderer=new HuesCanvas(r.root,r.soundManager,r),r.settings.addEventListener("updated",r.settingsUpdated.bind(r)),r.settingsUpdated(),r.setColour(r.colourIndex),r.animationLoop(),r.settings.load?r.resourceManager.addAll(r.settings.respacks,function(e){r.preloader.style.backgroundPosition=100-100*e+"% 0%";var t=Math.floor(e*r.settings.preloadMax),e=r.settings.preloadMax.toString(r.settings.preloadBase).length;r.preloadMsg.textContent=r.settings.preloadPrefix+(Array(e).join("0")+t.toString(r.settings.preloadBase)).slice(-e)}):void(r.preloader.style.display="none")}).then(function(){r.preloader.classList.add("hues-preloader--loaded"),r.callEventListeners("loaded"),r.settings.firstImage?r.setImageByName(r.settings.firstImage):r.setImage(0),r.settings.autoplay&&(r.settings.firstSong?r.setSongByName(r.settings.firstSong):r.setSong(0))}).catch(function(e){r.error(e)}),this.settings.disableKeyboard||s.addEventListener("keydown",function(e){if((e=e||n.event).defaultPrevented)return!0;if(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)return!0;if("input"==e.target.tagName.toLowerCase()&&"text"==e.target.type||"true"===e.target.contentEditable)return!0;e=e.keyCode||e.which;return r.keyHandler(e)})}return _createClass(t,[{key:"callEventListeners",value:function(e){var t=Array.prototype.slice.call(arguments,1);this.eventListeners[e].forEach(function(e){e.apply(null,t)})}},{key:"addEventListener",value:function(e,t){if(e=e.toLowerCase(),void 0===this.eventListeners[e])throw Error("Unknown event: "+e);this.eventListeners[e].push(t)}},{key:"removeEventListener",value:function(e,t){if(e=e.toLowerCase(),void 0===this.eventListeners[e])throw Error("Unknown event: "+e);this.eventListeners[e]=this.eventListeners[e].filter(function(e){return e!==t})}},{key:"makePreloader",value:function(e){this.preloader=s.createElement("div"),this.preloader.className="hues-preloader",e.appendChild(this.preloader),this.settings.preloadTitle&&(this.preloadTitle=s.createElement("div"),this.preloadTitle.className="hues-preloader__title",this.preloadTitle.textContent=this.settings.preloadTitle,this.preloader.appendChild(this.preloadTitle)),this.preloadMsg=s.createElement("div"),this.preloadMsg.className="hues-preloader__text",this.preloadMsg.textContent="Initialising...",this.preloader.appendChild(this.preloadMsg),this.preloadSubMsg=s.createElement("div"),this.preloadSubMsg.className="hues-preloader__subtext",this.preloader.appendChild(this.preloadSubMsg)}},{key:"resizeVisualiser",value:function(){this.soundManager.initVisualiser(this.visualiser.width/2)}},{key:"updateVisualiser",value:function(){if("on"==this.settings.visualiser){var e=this.soundManager.getVisualiserData();if(e){this.vCtx.clearRect(0,0,this.vCtx.canvas.width,this.vCtx.canvas.height);var t=this.vCtx.createLinearGradient(0,64,0,0);this.invert?(t.addColorStop(1,"rgba(20,20,20,0.6)"),t.addColorStop(0,"rgba(255,255,255,0.6)")):(t.addColorStop(1,"rgba(255,255,255,0.6)"),t.addColorStop(0,"rgba(20,20,20,0.6)")),this.vCtx.fillStyle=t;for(var n=0,s=0;s<e.length;s++)for(var i=e[s],r=0;r<i.length;r++){var a=i[2==e.length&&0===s?i.length-r-1:r]/4;this.vCtx.fillRect(n,this.vCtx.canvas.height-a,2,a),n+=2}}}}},{key:"animationLoop",value:function(){if(requestAnimationFrame(this.animationLoop.bind(this)),this.soundManager.playing){this.updateVisualiser();var e=this.soundManager.currentTime;this.callEventListeners("time",this.soundManager.clampedTime),0<=e&&this.doBuildup&&(this.currentSong.buildupPlayed=!0);for(var t=this.beatIndex*this.getBeatLength();t<e;t=++this.beatIndex*this.getBeatLength()){var n=this.getBeat(this.beatIndex);this.beater(n)}this.callEventListeners("frame")}else this.callEventListeners("frame")}},{key:"recalcBeatIndex",value:function(e){var t="number"==typeof e?e:this.soundManager.currentTime;if(this.beatIndex=Math.floor(t/(t<0?this.buildLength:this.loopLength)),this.beatIndex==this.beatIndex){e=this.currentSong.buildupRhythm,t=this.currentSong.rhythm;if(this.beatIndex<0)n=e.slice(0,Math.max(this.beatIndex+e.length,0));else{if((t.match(/i|I/g)||[]).length%2)return;n=(e||"")+t.slice(0,this.beatIndex)}var n=(n.match(/i|I/g)||[]).length;this.setInvert(n%2)}else this.setInvert(!1)}},{key:"getBeatIndex",value:function(){return this.soundManager.playing?this.beatIndex<0?this.beatIndex:this.beatIndex%this.currentSong.rhythm.length:0}},{key:"getSafeBeatIndex",value:function(){var e=this.getBeatIndex();return e<0?0:e}},{key:"blurUpdated",value:function(e,t){this.callEventListeners("blurupdate",e,t)}},{key:"nextSong",value:function(){var e=(this.songIndex+1)%this.resourceManager.enabledSongs.length;this.setSong(e)}},{key:"previousSong",value:function(){var e=(this.songIndex-1+this.resourceManager.enabledSongs.length)%this.resourceManager.enabledSongs.length;this.setSong(e)}},{key:"setSongByName",value:function(e){for(var t=this.resourceManager.enabledSongs,n=0,s=0,i=0;i<t.length;i++){var r=t[i].title.score(e);s<r&&(s=r,n=i)}return this.setSong(n)}},{key:"setSongOject",value:function(e){for(var t=0;t<this.resourceManager.enabledSongs.length;t++)if(this.resourceManager.enabledSongs[t]===e)return this.setSong(t)}},{key:"setSong",value:function(e,t){var n=this;if(this.currentSong!=this.resourceManager.enabledSongs[e]){if(t||(this.lastSongArray=[]),this.lastSongArray.push(e),this.songIndex=e,this.currentSong=this.resourceManager.enabledSongs[this.songIndex],void 0===this.currentSong&&(this.currentSong={name:"None",title:"None",rhythm:".",source:null,crc:"none",sound:null,enabled:!0,filename:"none"}),console.log("Next song:",this.songIndex,this.currentSong),this.callEventListeners("newsong",this.currentSong),this.loopCount=0,this.currentSong.buildup)switch(this.settings.playBuildups){case"off":this.currentSong.buildupPlayed=!0,this.doBuildup=!1;break;case"on":this.currentSong.buildupPlayed=!1,this.doBuildup=!0;break;case"once":this.doBuildup=!this.currentSong.buildupPlayed}return this.setInvert(!1),this.renderer.doInstantBlackout(),this.soundManager.playSong(this.currentSong,this.doBuildup).then(function(){n.resetAudio(),n.fillBuildup(),n.callEventListeners("songstarted",n.currentSong)})}}},{key:"updateBeatLength",value:function(){this.loopLength=this.soundManager.loopLength/this.currentSong.rhythm.length,this.currentSong.buildup?(this.currentSong.buildupRhythm||(this.currentSong.buildupRhythm="."),this.buildLength=this.soundManager.buildLength/this.currentSong.buildupRhythm.length):this.buildLength=-1}},{key:"getBeatLength",value:function(){return this.beatIndex<0?this.buildLength:this.loopLength}},{key:"fillBuildup",value:function(){if(this.updateBeatLength(),this.currentSong.buildup)if(this.currentSong.independentBuild)console.log("New behaviour - separate build/loop lengths");else{console.log("Flash behaviour - filling buildup");var e=Math.floor(this.soundManager.buildLength/this.loopLength);for(e<1&&(e=1);this.currentSong.buildupRhythm.length<e;)this.currentSong.buildupRhythm=this.currentSong.buildupRhythm+".";console.log("Buildup length:",e)}this.updateBeatLength(),this.recalcBeatIndex(this.doBuildup?-this.soundManager.buildLength:0)}},{key:"randomSong",value:function(){var e=this.resourceManager.enabledSongs.length,t=Math.floor(Math.random()*e);if(1<e&&(t==this.songIndex||-1!=this.lastSongArray.indexOf(t)))this.randomSong();else{console.log("Randoming a song!"),this.setSong(t,!0);for(var n=Math.min(5,Math.floor(e/2));this.lastSongArray.length>n&&0<=n;)this.lastSongArray.shift()}}},{key:"loopCheck",value:function(){Math.floor(this.soundManager.currentTime/this.soundManager.loopLength)>this.loopCount&&this.onLoop()}},{key:"onLoop",value:function(){switch(this.loopCount++,this.settings.autoSong){case"loop":console.log("Checking loops"),this.loopCount>=this.settings.autoSongDelay&&this.doAutoSong();break;case"time":console.log("Checking times"),this.soundManager.loopLength*this.loopCount>=60*this.settings.autoSongDelay&&this.doAutoSong()}}},{key:"doAutoSong",value:function(){var e=this,t=null;this.resourceManager.enabledSongs.length<2||(t="on"==this.settings.autoSongShuffle?this.randomSong:this.nextSong,"on"==this.settings.autoSongFadeout?this.soundManager.fadeOut(function(){t.call(e)}):t.call(this))}},{key:"songDataUpdated",value:function(){this.currentSong&&(this.callEventListeners("newsong",this.currentSong),this.callEventListeners("newimage",this.currentImage))}},{key:"resetAudio",value:function(){this.beatIndex=0,this.songDataUpdated(),"on"==this.settings.visualiser&&this.soundManager.initVisualiser(this.visualiser.width/2)}},{key:"randomImage",value:function(){if("on"==this.settings.shuffleImages){var e=this.resourceManager.enabledImages.length,t=Math.floor(Math.random()*e);if((t==this.imageIndex||-1!=this.lastImageArray.indexOf(t))&&1<e)this.randomImage();else{this.setImage(t,!0),this.lastImageArray.push(t);for(var n=Math.min(20,Math.floor(e/2));this.lastImageArray.length>n&&0<=n;)this.lastImageArray.shift()}}else{e=(this.imageIndex+1)%this.resourceManager.enabledImages.length;this.setImage(e)}}},{key:"setImage",value:function(e,t){this.imageIndex=e||0;e=this.resourceManager.enabledImages[this.imageIndex];e==this.currentImage&&null!==e||(t||(this.lastImageArray=[]),e?this.currentImage=e:(this.currentImage={name:"None",fullname:"None",align:"center",bitmap:null,source:null,enabled:!0},this.imageIndex=-1,this.lastImageArray=[]),this.callEventListeners("newimage",this.currentImage))}},{key:"setImageByName",value:function(e){for(var t=this.resourceManager.enabledImages,n=0;n<t.length;n++)if(t[n].name==e||t[n].fullname==e)return void this.setImage(n);this.setImage(0)}},{key:"nextImage",value:function(){this.setIsFullAuto(!1);var e=(this.imageIndex+1)%this.resourceManager.enabledImages.length;this.setImage(e)}},{key:"previousImage",value:function(){this.setIsFullAuto(!1);var e=(this.imageIndex-1+this.resourceManager.enabledImages.length)%this.resourceManager.enabledImages.length;this.setImage(e)}},{key:"randomColourIndex",value:function(){var e=Math.floor(Math.random()*this.colours.length);return e==this.colourIndex?this.randomColourIndex():e}},{key:"randomColour",value:function(e){var t=this.randomColourIndex();this.setColour(t,e)}},{key:"setColour",value:function(e,t){this.colourIndex=e;e=this.colours[this.colourIndex];this.callEventListeners("newcolour",e,t)}},{key:"getBeat",value:function(e){return e<0?this.currentSong.buildupRhythm[this.currentSong.buildupRhythm.length+e]:this.currentSong.rhythm[e%this.currentSong.rhythm.length]}},{key:"beater",value:function(e){switch(this.callEventListeners("beat",this.getBeatString(),this.getBeatIndex()),e){case"X":case"x":this.renderer.doYBlur();break;case"O":case"o":this.renderer.doXBlur();break;case")":this.renderer.doTrippyX();break;case"(":this.renderer.doTrippyY();break;case"+":this.renderer.doXBlur(),this.renderer.doBlackout();break;case"¤":this.renderer.doXBlur(),this.renderer.doBlackout(!0);break;case"|":this.renderer.doShortBlackout(this.getBeatLength()),this.randomColour();break;case":":this.randomColour();break;case"*":this.settings.fullAuto&&this.randomImage();break;case"=":this.settings.fullAuto&&this.randomImage();case"~":this.renderer.doColourFade(this.timeToNextBeat()),this.randomColour(!0);break;case"S":case"s":this.renderer.doSlice(this.getBeatLength(),this.charsToNextBeat(),!1,!0);break;case"V":case"v":this.renderer.doSlice(this.getBeatLength(),this.charsToNextBeat(),!0,!1);break;case"@":case"#":this.renderer.doSlice(this.getBeatLength(),this.charsToNextBeat(),!0,!0);break;case"I":this.settings.fullAuto&&this.randomImage();case"i":this.toggleInvert()}-1==[".","+","|","¤"].indexOf(e)&&this.renderer.clearBlackout(),-1==[".","+","¤",":","*","X","O","~","=","i","I","s","v","#"].indexOf(e)&&(this.randomColour(),this.settings.fullAuto&&this.randomImage())}},{key:"charsToNextBeat",value:function(){var e,t=this.currentSong.rhythm.length;for(this.beatIndex<0&&(t-=this.beatIndex),e=1;e<=t&&"."==this.getBeat(e+this.beatIndex);e++);return e}},{key:"timeToNextBeat",value:function(){return this.charsToNextBeat()*this.getBeatLength()/this.soundManager.playbackRate}},{key:"getBeatString",value:function(e){e=e||256;var t="",n=this.currentSong;if(n)for(t=this.beatIndex<0?n.buildupRhythm.slice(n.buildupRhythm.length+this.beatIndex):n.rhythm.slice(this.beatIndex%n.rhythm.length);t.length<e;)t+=n.rhythm;return t}},{key:"setIsFullAuto",value:function(e){this.settings.fullAuto=e,this.userInterface&&this.callEventListeners("newmode",this.settings.fullAuto)}},{key:"toggleFullAuto",value:function(){this.setIsFullAuto(!this.settings.fullAuto)}},{key:"setInvert",value:function(e){this.invert=!!e,this.callEventListeners("invert",e)}},{key:"toggleInvert",value:function(){this.setInvert(!this.invert)}},{key:"respackLoaded",value:function(){this.init()}},{key:"changeUI",value:function(e){0<=e&&this.uiArray.length>e&&this.userInterface!=this.uiArray[e]&&(this.hideLists(),this.userInterface&&this.userInterface.disconnect(),this.userInterface=this.uiArray[e],this.userInterface.connectCore(this),this.callEventListeners("newmode",this.settings.fullAuto),this.callEventListeners("newsong",this.currentSong),this.callEventListeners("newimage",this.currentImage),this.callEventListeners("newcolour",this.colours[this.colourIndex],!1),this.callEventListeners("beat",this.getBeatString(),this.getBeatIndex()),this.callEventListeners("invert",this.invert))}},{key:"settingsUpdated",value:function(){switch(this.callEventListeners("settingsupdated"),this.settings.currentUI){case"retro":this.changeUI(0);break;case"v4.20":this.changeUI(1);break;case"modern":this.changeUI(2);break;case"xmas":this.changeUI(3);break;case"hlwn":this.changeUI(4);break;case"mini":this.changeUI(5)}switch(this.settings.colourSet){case"normal":this.colours=t.oldColours;break;case"pastel":this.colours=t.pastelColours;break;case"v4.20":this.colours=t.weedColours}switch(this.settings.blackoutUI){case"off":this.userInterface.show();break;case"on":this.renderer.blackout&&this.userInterface.hide()}switch(this.settings.visualiser){case"off":this.visualiser.classList.add("hidden");break;case"on":this.visualiser.classList.remove("hidden"),this.soundManager.vReady||this.soundManager.initVisualiser(this.visualiser.width/2)}"off"==this.autoSong&&"off"!=this.settings.autoSong&&(console.log("Resetting loopCount since AutoSong was enabled"),this.loopCount=0),this.autoSong=this.settings.autoSong}},{key:"enabledChanged",value:function(){this.resourceManager.rebuildEnabled()}},{key:"hideLists",value:function(){this.resourceManager.hideLists()}},{key:"toggleSongList",value:function(){this.window.hide(),this.resourceManager.toggleSongList()}},{key:"toggleImageList",value:function(){this.window.hide(),this.resourceManager.toggleImageList()}},{key:"openSongSource",value:function(){this.currentSong&&this.currentSong.source&&n.open(this.currentSong.source,"_blank")}},{key:"openImageSource",value:function(){this.currentImage&&this.currentImage.source&&n.open(this.currentImage.source,"_blank")}},{key:"keyHandler",value:function(e){switch(e){case 37:this.previousImage();break;case 39:this.nextImage();break;case 38:this.nextSong();break;case 40:this.previousSong();break;case 70:this.toggleFullAuto();break;case 109:case 189:case 173:this.soundManager.decreaseVolume();break;case 107:case 187:case 61:this.soundManager.increaseVolume();break;case 66:this.soundManager.seek(-this.soundManager.buildLength);break;case 77:this.soundManager.toggleMute();break;case 72:this.userInterface.toggleHide();break;case 82:this.window.selectTab("RESOURCES");break;case 69:this.window.selectTab("EDITOR");break;case 79:this.window.selectTab("OPTIONS");break;case 73:this.window.selectTab("INFO");break;case 49:this.settings.set("currentUI","retro");break;case 50:this.settings.set("currentUI","v4.20");break;case 51:this.settings.set("currentUI","modern");break;case 52:this.settings.set("currentUI","xmas");break;case 53:this.settings.set("currentUI","hlwn");break;case 54:this.settings.set("currentUI","mini");break;case 67:this.toggleImageList();break;case 83:this.toggleSongList();break;case 87:this.window.toggle();break;case 78:this.randomSong();break;default:return!0}return!1}},{key:"error",value:function(e){console.log(e),this.preloadSubMsg.textContent=e,this.preloadMsg.style.color="#F00"}},{key:"warning",value:function(e){console.log(e),this.preloadSubMsg.innerHTML=e,this.preloadMsg.style.color="#F93"}},{key:"clearMessage",value:function(){this.preloadSubMsg.textContent="",this.preloadMsg.style.color=""}}]),t}();e.oldColours=[{c:0,n:"black"},{c:5570560,n:"brick"},{c:11141120,n:"crimson"},{c:16711680,n:"red"},{c:21760,n:"turtle"},{c:5592320,n:"sludge"},{c:11162880,n:"brown"},{c:16733440,n:"orange"},{c:43520,n:"green"},{c:5614080,n:"grass"},{c:11184640,n:"maize"},{c:16755200,n:"citrus"},{c:65280,n:"lime"},{c:5635840,n:"leaf"},{c:11206400,n:"chartreuse"},{c:16776960,n:"yellow"},{c:85,n:"midnight"},{c:5570645,n:"plum"},{c:11141205,n:"pomegranate"},{c:16711765,n:"rose"},{c:21845,n:"swamp"},{c:5592405,n:"dust"},{c:11162965,n:"dirt"},{c:16733525,n:"blossom"},{c:43605,n:"sea"},{c:5614165,n:"ill"},{c:11184725,n:"haze"},{c:16755285,n:"peach"},{c:65365,n:"spring"},{c:5635925,n:"mantis"},{c:11206485,n:"brilliant"},{c:16777045,n:"canary"},{c:170,n:"navy"},{c:5570730,n:"grape"},{c:11141290,n:"mauve"},{c:16711850,n:"purple"},{c:21930,n:"cornflower"},{c:5592490,n:"deep"},{c:11163050,n:"lilac"},{c:16733610,n:"lavender"},{c:43690,n:"aqua"},{c:5614250,n:"steel"},{c:11184810,n:"grey"},{c:16755370,n:"pink"},{c:65450,n:"bay"},{c:5636010,n:"marina"},{c:11206570,n:"tornado"},{c:16777130,n:"saltine"},{c:255,n:"blue"},{c:5570815,n:"twilight"},{c:11141375,n:"orchid"},{c:16711935,n:"magenta"},{c:22015,n:"azure"},{c:5592575,n:"liberty"},{c:11163135,n:"royalty"},{c:16733695,n:"thistle"},{c:43775,n:"ocean"},{c:5614335,n:"sky"},{c:11184895,n:"periwinkle"},{c:16755455,n:"carnation"},{c:65535,n:"cyan"},{c:5636095,n:"turquoise"},{c:11206655,n:"powder"},{c:16777215,n:"white"}],e.pastelColours=[{c:13453898,n:"Mahogany"},{c:16443317,n:"Banana Mania"},{c:10453360,n:"Beaver"},{c:2302755,n:"Black"},{c:12344664,n:"Chestnut"},{c:14521461,n:"Copper"},{c:10145515,n:"Cornflower"},{c:2845892,n:"Denim"},{c:15715768,n:"Desert Sand"},{c:7229792,n:"Eggplant"},{c:1964308,n:"Electric Lime"},{c:7453816,n:"Fern"},{c:16570741,n:"Goldenrod"},{c:11068576,n:"Granny Smith Apple"},{c:9802124,n:"Gray"},{c:1879160,n:"Green"},{c:16719310,n:"Hot Magenta"},{c:11725917,n:"Inch Worm"},{c:6125259,n:"Indigo"},{c:16645236,n:"Laser Lemon"},{c:16561365,n:"Lavender"},{c:16760200,n:"Macaroni and Cheese"},{c:9935530,n:"Manatee"},{c:16745027,n:"Mango Tango"},{c:16628916,n:"Melon"},{c:1722486,n:"Midnight Blue"},{c:16753475,n:"Neon Carrot"},{c:12236908,n:"Olive Green"},{c:16741688,n:"Orange"},{c:15116503,n:"Orchid"},{c:4278860,n:"Outer Space"},{c:16739914,n:"Outrageous Orange"},{c:1878473,n:"Pacific Blue"},{c:12964070,n:"Periwinkle"},{c:9323909,n:"Plum"},{c:7619272,n:"Purple Heart"},{c:14060121,n:"Raw Sienna"},{c:14886251,n:"Razzmatazz"},{c:15605837,n:"Red"},{c:2084555,n:"Robin Egg Blue"},{c:7885225,n:"Royal Purple"},{c:16751530,n:"Salmon"},{c:16525383,n:"Scarlet"},{c:10478271,n:"Sea Green"},{c:10840399,n:"Sepia"},{c:9075037,n:"Shadow"},{c:4574882,n:"Shamrock"},{c:16482045,n:"Shocking Pink"},{c:15526590,n:"Spring Green"},{c:16604755,n:"Sunset Orange"},{c:16426860,n:"Tan"},{c:16550316,n:"Tickle Me Pink"},{c:14407634,n:"Timberwolf"},{c:1540205,n:"Tropical Rain Forest"},{c:7855591,n:"Turquoise Blue"},{c:16752777,n:"Vivid Tangerine"},{c:9392285,n:"Vivid Violet"},{c:15592941,n:"White"},{c:16728996,n:"Wild Strawberry"},{c:16542853,n:"Wild Watermelon"},{c:13477086,n:"Wisteria"},{c:16574595,n:"Yellow"},{c:12968836,n:"Yellow Green"},{c:16758355,n:"Yellow Orange"}],e.weedColours=[{c:65280,n:"Green"},{c:5923665,n:"Lizard"},{c:6516567,n:"Cactus"},{c:4878371,n:"Kakapo"},{c:4018729,n:"Wet Moss"},{c:6659378,n:"Tree Moss"},{c:3297047,n:"Lime Rind"},{c:8357752,n:"Flight Jacket"},{c:12381585,n:"Green Mist"},{c:4751892,n:"Holly"},{c:5732922,n:"Mtn Dew Bottle"},{c:7635561,n:"Seaweed Roll"},{c:8647980,n:"Neon Green"},{c:12638639,n:"Lichen"},{c:10934149,n:"Guacamole"},{c:6848090,n:"Pond Scum"},{c:4153387,n:"Douglas Fir"},{c:4155430,n:"Royal Palm"},{c:6582110,n:"Seaweed"},{c:4680244,n:"Noble Fir"},{c:6159370,n:"Green Led"},{c:4414774,n:"Spinach"},{c:8699498,n:"Frog"},{c:6003812,n:"Emerald"},{c:3827241,n:"Circuit Board"},{c:3178516,n:"Sapgreen"},{c:3258701,n:"Pool Table"},{c:5615162,n:"Leaf"},{c:5094707,n:"Grass"},{c:5860438,n:"Snake"},{c:8832636,n:"100 Euro"},{c:8113264,n:"Night Vision"},{c:10494192,n:"Purple"},{c:10170623,n:"Purple"},{c:9514222,n:"Purple"},{c:8201933,n:"Purple"},{c:11141375,n:"Purple"},{c:8388736,n:"Purple"},{c:10964139,n:"Turnip"},{c:9395865,n:"Violet"},{c:8480391,n:"Eggplant"},{c:13369599,n:"Grape"},{c:8522683,n:"Wild Violet"},{c:6685080,n:"Concord Grape"},{c:7431037,n:"Garden Plum"},{c:11694758,n:"Purple Fish"},{c:6038638,n:"Ultramarine Violet"},{c:6172025,n:"Purple Rose"},{c:6830686,n:"Sea Urchin"},{c:9511326,n:"Cobalt Violet Deep"},{c:9135755,n:"Plum"},{c:10040013,n:"Dark Orchid"},{c:12541951,n:"Violet Flower"},{c:12427467,n:"Purple Candy"},{c:5577355,n:"Deep Purple"},{c:11882652,n:"Thistle"},{c:8855416,n:"Dark Purple"},{c:10251160,n:"Purple Ink"},{c:14381275,n:"Orchid"},{c:10027161,n:"True Purple"},{c:9109643,n:"Darkmagenta"},{c:11935876,n:"Harold's Crayon"},{c:6898825,n:"Purple Rain"},{c:16766720,n:"Gold"}],n.HuesCore=e}(window,document);
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}!function(r,k){var _=100,y=20,e=function(){function i(e,t){_classCallCheck(this,i),this.buildEditSize=80,this.buildEdit=null,this.loopEdit=null,this.editArea=null,this.wrapAt=32,this.hilightWidth=0,this.hilightHeight=0,this.undoBuffer=[],this.redoBuffer=[],this.batchUndoArray=null,this.buildWave=null,this.loopWave=null,this.buildWaveBuff=null,this.loopWaveBuff=null,this.waveContext=null,this.waveCanvas=null,this.respack=null,this.linked=!1,(this.core=e).settings.enableWindow&&(this.initUI(),e.addEventListener("beat",this.onBeat.bind(this)),e.addEventListener("newsong",this.onNewSong.bind(this)),t.addTab("EDITOR",this.root))}return _createClass(i,[{key:"initUI",value:function(){var i=this;this.root=k.createElement("div"),this.root.className="editor";var e=k.createElement("div");e.className="editor__title-buttons",this.root.appendChild(e),this.saveBtn=this.createButton("Save XML",e,!0),this.saveBtn.addEventListener("click",this.saveXML.bind(this)),this.copyBtn=this.createButton("Copy XML",e,!0),this.copyBtn.addEventListener("click",this.copyXML.bind(this)),this.undoBtn=this.createButton("Undo",e,!0),this.undoBtn.addEventListener("click",this.undo.bind(this)),this.redoBtn=this.createButton("Redo",e,!0),this.redoBtn.addEventListener("click",this.redo.bind(this));var t=this.createButton("Help?",e);t.style.backgroundColor="rgba(0,160,0,0.3)",t.addEventListener("click",function(){r.open("https://github.com/mon/0x40-web/tree/master/docs/Editor.md","_blank")}),this.statusMsg=k.createElement("span"),this.statusMsg.className="editor__status-msg",e.appendChild(this.statusMsg),this.topBar=k.createElement("div"),this.topBar.className="editor__top-bar",this.root.appendChild(this.topBar),this.uiCreateInfo(),this.uiCreateImport(),this.root.appendChild(k.createElement("hr")),this.uiCreateEditArea(),this.uiCreateControls(),this.uiCreateVisualiser(),k.addEventListener("keydown",function(e){if((e=e||r.event).defaultPrevented)return!0;var t=e.keyCode||e.which;return!e.ctrlKey||(90==t?i.undo():89==t&&i.redo(),90!=t&&89!=t)||(e.preventDefault(),!1)}),r.addEventListener("resize",this.resize.bind(this)),this.core.window.addEventListener("tabselected",this.resize.bind(this,!1)),this.resize()}},{key:"resize",value:function(e){this.root.style.height=r.innerHeight-200+"px";var t=this.editArea.offsetHeight,i=this.buildEdit._header.offsetHeight,n=this.loopEdit._header.offsetHeight,s=this.resizeHandle.offsetHeight,o=t-s-n-i,a=Math.min(o,Math.max(i,this.buildEditSize-s));this.buildEdit.style.height=a+"px",this.buildEdit._box.style.height=a-i+"px";o=o-a+n;if(this.loopEdit.style.height=o+"px",this.loopEdit._box.style.height=o-n+"px",this.editArea.offsetHeight!=t&&this.resize(),this.timeLock.style.height=a+s+"px",!e){e=k.createElement("div");e.className="beat-hilight";for(var h="",d=0;d<99;d++)h+="<br />";for(var l=0;l<100;l++)h+="&nbsp;";e.innerHTML=h,this.loopEdit.appendChild(e),this.hilightWidth=e.clientWidth/100,this.hilightHeight=e.clientHeight/100,this.loopEdit.removeChild(e),this.waveCanvas.width=this.waveCanvas.clientWidth}}},{key:"getOther",value:function(e){return e==this.loopEdit?this.buildEdit:this.loopEdit}},{key:"onNewSong",value:function(e){this.linked?e==this.song?(this.updateInfo(),this.updateWaveform()):(this.linked=!1,this.buildEdit._hilight.innerHTML="&block;",this.loopEdit._hilight.innerHTML="&block;",this.buildEdit._hilight.className="beat-hilight invisible",this.loopEdit._hilight.className="beat-hilight invisible",this.waveContext.clearRect(0,0,this.waveCanvas.width,y)):e==this.song&&(this.linked=!0)}},{key:"onBeat",value:function(e,t){var i,n;this.song&&this.core.currentSong==this.song&&(t<0?(t+=this.core.currentSong.buildupRhythm.length,i=this.buildEdit,this.loopEdit._hilight.className="beat-hilight invisible"):(i=this.loopEdit,this.song.buildup&&(this.buildEdit._hilight.className="beat-hilight invisible")),i._hilight.className="beat-hilight",n=t%this.wrapAt,t=Math.floor(t/this.wrapAt),i._hilight.style.left=Math.floor(n*this.hilightWidth)+"px",i._hilight.style.top=Math.floor(t*this.hilightHeight)+"px")}},{key:"reflow",value:function(e,t){if(!t)return e._beatmap.textContent="",e._hilight.textContent="[none]",e._hilight.className="beat-hilight",e._hilight.style.top="0",e._hilight.style.left="0",void(e._beatCount.textContent="0 beats");e._hilight.innerHTML="&block;",e._beatCount.textContent=t.length+" beats";var i=new RegExp("(.{"+this.wrapAt+"})","g");e._beatmap.innerHTML=t.replace(i,"$1<br />")}},{key:"updateInfo",value:function(){var e,t,i;this.seekStart.classList.add("hues-button--disabled"),this.seekLoop.classList.add("hues-button--disabled"),this.saveBtn.classList.add("hues-button--disabled"),this.copyBtn.classList.add("hues-button--disabled"),this.buildEdit._removeBtn.classList.add("hues-button--disabled"),this.loopEdit._removeBtn.classList.add("hues-button--disabled"),this.song&&(this.saveBtn.classList.remove("hues-button--disabled"),this.copyBtn.classList.remove("hues-button--disabled"),this.song.independentBuild?(this.timeLock._locker.innerHTML="&#xe904;",this.timeLock.classList.add("edit-area__timelock--unlocked")):(this.timeLock._locker.innerHTML="&#xe905;",this.timeLock.classList.remove("edit-area__timelock--unlocked")),this.song.sound&&(this.seekLoop.classList.remove("hues-button--disabled"),this.loopEdit._removeBtn.classList.remove("hues-button--disabled")),this.song.buildup&&(this.seekStart.classList.remove("hues-button--disabled"),this.buildEdit._removeBtn.classList.remove("hues-button--disabled")),this.linked&&(e=this.core.soundManager.loopLength,t=this.core.soundManager.buildLength,i=e/this.song.rhythm.length*1e3,this.loopLen.textContent=e.toFixed(2),this.buildLen.textContent=t.toFixed(2),this.beatLen.textContent=i.toFixed(2)))}},{key:"loadAudio",value:function(t){var e,i,n=this;t._fileInput.files.length<1||(this.newSong(this.song),e=!this.song[t._sound]&&!!this.song[this.getOther(t)._sound],i=t._fileInput.files[0],this.blobToArrayBuffer(i).then(function(e){var t={test:e};return n.core.soundManager.loadBuffer(t,"test").then(function(){return t.test})}).then(function(e){n.song[t._sound]=e;e=i.name.replace(/\.[^/.]+$/,"");if("sound"==t._sound?n.song.name=e:n.song.buildupName=e,n.getText(t)||n.setText(t,"x...o...x...o..."),n.song.sound)return n.core.soundManager.playSong(n.song,!0,!0)}).then(function(){e&&n.setIndependentBuild(!1),n.updateInfo(),n.core.updateBeatLength(),n.core.recalcBeatIndex(),n.updateWaveform()}).catch(function(e){console.log(e),n.alert("Couldn't load song! Is it a LAME encoded MP3?")}))}},{key:"removeAudio",value:function(e){var t=this;this.song&&(this.song[e._sound]=null,this.song[e._rhythm]="",this.setIndependentBuild(!0),this.reflow(e,""),this.song.sound&&this.linked?this.core.soundManager.playSong(this.song,!0,!0).then(function(){t.updateWaveform()}):(this.core.soundManager.stop(),this.updateWaveform()),this.updateInfo(),this.updateHalveDoubleButtons(e))}},{key:"blobToArrayBuffer",value:function(n){return new Promise(function(e,t){var i=new FileReader;i.onload=function(){e(i.result)},i.onerror=function(){t(new Error("File read failed!"))},i.readAsArrayBuffer(n)})}},{key:"newSong",value:function(e){e||(e={name:"Name",title:"Title",rhythm:"",source:"",sound:null,enabled:!0,filename:null,charsPerBeat:null,independentBuild:!0},this.respack||(this.respack=new Respack,this.respack.name="Editor Respack",this.respack.author="You!",this.respack.description="An internal resourcepack for editing new songs",this.core.resourceManager.addPack(this.respack)),this.respack.songs.push(e),this.core.resourceManager.rebuildArrays(),this.core.resourceManager.rebuildEnabled(),this.core.setSongOject(e)),this.buildEdit._hilight.className="beat-hilight invisible",this.loopEdit._hilight.className="beat-hilight invisible",this.newSongBtn.classList.remove("hues-button--glow"),this.fromSongBtn.classList.remove("hues-button--glow"),this.title.disabled=!1,this.source.disabled=!1,this.clearUndoRedo(),this.song=e,this.reflow(this.buildEdit,e.buildupRhythm),this.reflow(this.loopEdit,e.rhythm),this.title.value=e.title,this.source.value=e.source,this.updateIndependentBuild(),this.setLocked(this.buildEdit,0),this.setLocked(this.loopEdit,0),this.linked=!0,this.updateInfo(),this.updateWaveform()}},{key:"updateIndependentBuild",value:function(){!!this.song.buildup!=!!this.song.sound&&this.setIndependentBuild(!0)}},{key:"setIndependentBuild",value:function(e){(this.song.independentBuild=e)||(e=this.loopEdit._locked&&this.buildEdit._locked,this.loopEdit._locked=0,this.buildEdit._locked=0,this.setText(this.loopEdit,this.getText(this.loopEdit)),e&&(this.loopEdit._locked=this.song.rhythm.length,this.buildEdit._locked=this.song.buildupRhythm.length)),this.updateInfo()}},{key:"batchUndo",value:function(){this.batchUndoArray||(this.batchUndoArray=[])}},{key:"commitUndo",value:function(){this.batchUndoArray&&(this.undoBuffer.push(this.batchUndoArray),this.trimUndo(),this.batchUndoArray=null,this.updateUndoUI())}},{key:"pushUndo",value:function(e,t,i,n){i!=n&&(this.redoBuffer=[],i={songVar:e,editor:t,text:i,indep:this.song.independentBuild},this.batchUndoArray?this.batchUndoArray.push(i):(this.undoBuffer.push([i]),this.trimUndo()),this.updateUndoUI())}},{key:"trimUndo",value:function(){for(;50<this.undoBuffer.length;)this.undoBuffer.shift()}},{key:"undo",value:function(){this.undoRedo(this.undoBuffer,this.redoBuffer)}},{key:"redo",value:function(){this.undoRedo(this.redoBuffer,this.undoBuffer)}},{key:"undoRedo",value:function(e,t){if(0!==e.length&&this.song){for(var i=e.pop(),n=[],s=0;s<i.length;s++){var o=i[s];n.push({songVar:o.songVar,editor:o.editor,text:this.song[o.songVar],indep:this.song.independentBuild}),this.song[o.songVar]=o.text,this.song.independentBuild=o.indep,o.editor._locked&&(o.editor._locked=o.text.length),this.reflow(o.editor,this.song[o.songVar]),this.updateHalveDoubleButtons(o.editor)}t.push(n),this.updateUndoUI(),this.updateInfo(),this.core.updateBeatLength(),this.core.recalcBeatIndex()}}},{key:"clearUndoRedo",value:function(){this.undoBuffer=[],this.redoBuffer=[],this.updateUndoUI()}},{key:"updateUndoUI",value:function(){this.undoBtn.className="hues-button hues-button--disabled",this.redoBtn.className="hues-button hues-button--disabled",0<this.undoBuffer.length&&this.undoBtn.classList.remove("hues-button--disabled"),0<this.redoBuffer.length&&this.redoBtn.classList.remove("hues-button--disabled")}},{key:"halveBeats",value:function(e){var t,i=!1;this.song.independentBuild||(i=!0,this.batchUndo(),t=this.getOther(e),this.song.independentBuild=!0,this.halveBeats(t)),this.setText(e,this.song[e._rhythm].replace(/(.)./g,"$1")),i&&(this.commitUndo(),this.setIndependentBuild(!1))}},{key:"doubleBeats",value:function(e){var t,i=!1;this.song.independentBuild||(i=!0,this.batchUndo(),t=this.getOther(e),this.song.independentBuild=!0,this.doubleBeats(t)),this.setText(e,this.song[e._rhythm].replace(/(.)/g,"$1.")),i&&(this.commitUndo(),this.setIndependentBuild(!1))}},{key:"updateHalveDoubleButtons",value:function(e){var t,i;e._halveBtn.className="hues-button hues-button--disabled",e._doubleBtn.className="hues-button hues-button--disabled",e._locked||(i=this.getText(e).length,this.song.independentBuild||(t=this.getOther(e),i=Math.min(i,this.getText(t).length)),0<i&&(e._doubleBtn.className="hues-button"),1<i&&(e._halveBtn.className="hues-button"))}},{key:"createTextInput",value:function(e,t,i){var n=k.createElement("div");n.className="editor__label";var s=k.createElement("label");s.innerHTML=e,n.appendChild(s);e=k.createElement("span");e.className="editor__textinput-container";s=k.createElement("input");return s.className="editor__textinput",s.type="text",s.value=t,e.appendChild(s),n.appendChild(e),i.appendChild(n),s}},{key:"createButton",value:function(e,t,i,n){var s=k.createElement("span");return s.className="hues-button",i&&s.classList.add("hues-button--disabled"),n&&(s.className+=" "+n),s.addEventListener("click",function(e){return!s.classList.contains("hues-button--disabled")||(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!1)}),s.innerHTML=e.toUpperCase(),t.appendChild(s),s}},{key:"uiCreateInfo",value:function(){var e=k.createElement("div");this.topBar.appendChild(e),e.className="editor__info";function t(e){this.song&&(this.song[e]=this[e].value,this.song==this.core.currentSong&&this.core.callEventListeners("newsong",this.song))}this.title=this.createTextInput("Title:","Song name",e),this.title.oninput=t.bind(this,"title"),this.title.disabled=!0,this.source=this.createTextInput("Link:&nbsp;","Source link",e),this.source.oninput=t.bind(this,"source"),this.source.disabled=!0}},{key:"uiCreateImport",value:function(){var e=this,t=k.createElement("div");this.topBar.appendChild(t),t.className="editor__imports";var i=k.createElement("div");t.appendChild(i);var n=this.createButton("New song",i,!1,"hues-button--glow");n.addEventListener("click",function(){e.newSong()}),this.newSongBtn=n;i=this.createButton("Edit current song",i,!1,"hues-button--glow");i.addEventListener("click",function(){e.core.currentSong&&e.newSong(e.core.currentSong)}),this.fromSongBtn=i;i=k.createElement("div");i.className="settings-individual editor__song-stats",t.appendChild(i),this.loopLen=this.uiCreateSongStat("Loop length (s):","0.00",i),this.buildLen=this.uiCreateSongStat("Build length (s):","0.00",i),this.beatLen=this.uiCreateSongStat("Beat length (ms):","0.00",i)}},{key:"uiCreateSongStat",value:function(e,t,i){var n=k.createElement("div");i.appendChild(n);i=k.createElement("span");i.textContent=e,n.appendChild(i);i=k.createElement("span");return i.textContent=t,i.className="editor__song-stats__value",n.appendChild(i),i}},{key:"uiCreateEditArea",value:function(){var s=this,e=k.createElement("div");(this.editArea=e).className="edit-area",this.root.appendChild(e),this.timeLock=k.createElement("div"),e.appendChild(this.timeLock),this.timeLock.className="hues-icon edit-area__timelock edit-area__timelock--unlocked";var t=this.createButton("&#xe904;",this.timeLock);t.addEventListener("click",function(){s.song&&s.song.buildup&&s.song.sound&&s.setIndependentBuild(!s.song.independentBuild)}),this.timeLock._locker=t,this.buildEdit=this.uiCreateSingleEditor("Buildup","buildup","buildupRhythm",e),this.seekStart=this.buildEdit._seek,this.seekStart.innerHTML="&#xe90b;",this.seekStart.addEventListener("click",function(){s.core.soundManager.seek(-s.core.soundManager.buildLength)});var i=k.createElement("div");i.className="resize-handle",e.appendChild(i);t=k.createElement("div");t.className="hues-icon resize-handle__handle",t.innerHTML="&#xe908;",i.appendChild(t),(this.resizeHandle=i).addEventListener("mousedown",function(e){e.preventDefault();function i(e){s.buildEditSize=Math.floor(e.clientY-t+n/2),s.resize(!0)}var t=s.editArea.getBoundingClientRect().top,n=s.resizeHandle.clientHeight,e=function e(t){k.removeEventListener("mousemove",i),k.removeEventListener("mouseup",e)};k.addEventListener("mousemove",i),k.addEventListener("mouseup",e)}),this.loopEdit=this.uiCreateSingleEditor("Rhythm&nbsp;","sound","rhythm",e),this.seekLoop=this.loopEdit._seek,this.seekLoop.innerHTML="&#xe90b;",this.seekLoop.addEventListener("click",function(){s.core.soundManager.seek(0)}),this.buildEdit._hilight.textContent="[none]",this.loopEdit._hilight.innerHTML='<br />Click [LOAD RHYTHM] to load a loop! LAME encoded MP3s work best.<br />(LAME is important for seamless MP3 loops)<br /><br />[DOUBLE] doubles the selected map length by padding it with "."s.<br />[HALVE] shortens the map length by removing every other character.<br /><br />You can also add a buildup with [LOAD BUILDUP], or remove it<br />with [REMOVE].<br /><br />[NEW SONG] adds a completely empty song for you to edit, and<br />[EDIT CURRENT SONG] takes the current playing song to the editor.<br /><br />[COPY/SAVE XML] allow for storing the rhythms and easy <br />inclusion into a Resource Pack!'}},{key:"uiCreateSingleEditor",value:function(e,t,i,n){var s=this,o=k.createElement("div");n.appendChild(o);var a=k.createElement("div");a.className="edit-area__header",o.appendChild(a);var h=k.createElement("span");a.appendChild(h),h.innerHTML=e;var d=this.createButton("",a,!0,"hues-icon");a.appendChild(d),o._seek=d;n=k.createElement("span");a.appendChild(n),n.className="edit-area__beat-count",n.textContent="0 beats",o._lockedBtn=this.createButton("&#xe907;",a,!1,"hues-icon"),o._lockedBtn.addEventListener("click",function(){var e;o._locked?s.setLocked(o,0):(e=s.getText(o).length,s.setLocked(o,e))});h=k.createElement("span");h.className="edit-area__header__right",a.appendChild(h),o._halveBtn=this.createButton("Halve",h,!0),o._halveBtn.addEventListener("click",this.halveBeats.bind(this,o)),o._doubleBtn=this.createButton("Double",h,!0),o._doubleBtn.addEventListener("click",this.doubleBeats.bind(this,o));var l=k.createElement("input");l.type="file",l.accept=".mp3, .wav, .ogg",l.multiple=!1,l.onchange=this.loadAudio.bind(this,o),this.createButton("Load "+e.replace(/&nbsp;/g,""),h).addEventListener("click",function(){l.click()}),o._removeBtn=this.createButton("Remove",h,!0),o._removeBtn.addEventListener("click",this.removeAudio.bind(this,o));d=k.createElement("div");d.className="edit-area__box";e=k.createElement("div");e.className="edit-area__beatmap",e.contentEditable=!0,e.spellcheck=!1,e.oninput=this.textUpdated.bind(this,o),e.oncontextmenu=this.rightClick.bind(this,o);h=k.createElement("div");return h.className="beat-hilight",d.appendChild(h),d.appendChild(e),o.appendChild(d),o._header=a,o._beatCount=n,o._box=d,o._beatmap=e,o._hilight=h,o._fileInput=l,o._sound=t,o._rhythm=i,o._locked=0,o}},{key:"uiCreateControls",value:function(){var e=this,t=k.createElement("div");t.className="edit__controls",this.root.appendChild(t);function i(e){var t=this.core.soundManager.playbackRate;t+=e,this.core.soundManager.setRate(t),t=this.core.soundManager.playbackRate,s.textContent=t.toFixed(2)+"x"}var n=k.createElement("div");t.appendChild(n),this.createButton("&#xe909;",n,!1,"hues-icon").addEventListener("click",i.bind(this,-.25)),this.createButton("&#xe90a;",n,!1,"hues-icon").addEventListener("click",i.bind(this,.25));var s=k.createElement("span");s.className="settings-individual",s.textContent="1.00x",n.appendChild(s);n=k.createElement("div");t.appendChild(n);t=k.createElement("span");t.className="settings-individual",t.textContent="New line at beat ",n.appendChild(t);var o=k.createElement("input");o.className="settings-input",o.value=this.wrapAt,o.type="text",o.oninput=function(){o.value=o.value.replace(/\D/g,""),""===o.value||o.value<1?o.value="":(e.wrapAt=parseInt(o.value),e.reflow(e.buildEdit,e.song.buildupRhythm),e.reflow(e.loopEdit,e.song.rhythm))},n.appendChild(o)}},{key:"uiCreateVisualiser",value:function(){var e=k.createElement("canvas");e.className="waveform",e.height=y,this.root.appendChild(e),this.waveCanvas=e,this.waveContext=e.getContext("2d"),this.core.addEventListener("frame",this.drawWave.bind(this))}},{key:"rightClick",value:function(e,t){if(this.linked){var i=this.getTextCoords(t);if(i.x>this.wrapAt)return!0;var n=i.y*this.wrapAt+i.x,i=this.getText(e).length;if(i<n)return!0;this.setCaret(e._beatmap,n);n=n/i,i=0;return i=e==this.loopEdit?this.core.soundManager.loopLength*n:(e=this.core.soundManager.buildLength)*n-e,this.core.soundManager.seek(i),t.preventDefault(),!1}}},{key:"getTextCoords",value:function(e){for(var t=e.target,i=0,n=0;t&&!isNaN(t.offsetLeft)&&!isNaN(t.offsetTop);)i+=t.offsetLeft-t.scrollLeft,n+=t.offsetTop-t.scrollTop,t=t.offsetParent;return{x:i=Math.floor((e.clientX-i)/this.hilightWidth),y:n=Math.floor((e.clientY-n)/this.hilightHeight)}}},{key:"textUpdated",value:function(e){var t;this.song&&this.song[e._sound]?(0===(t=e._beatmap.textContent.replace(/ |\u00a0/g,"")).length&&(t="."),this.setText(e,t)):this.reflow(e,"")}},{key:"getText",value:function(e){return this.song&&this.song[e._rhythm]?this.song[e._rhythm]:""}},{key:"setText",value:function(e,t,i){if(this.song&&this.song[e._sound]){var n=!1,s=i?t.length:this.getCaret(e._beatmap);if(e._locked)if(s=Math.min(e._locked,s),t.length>e._locked)t=t.slice(0,s)+t.slice(s+(t.length-e._locked),t.length);else for(;t.length<e._locked;)t+=".";else if(!this.song.independentBuild&&this.song.buildupRhythm&&this.song.rhythm){for(var o=e==this.loopEdit?this.core.soundManager.loopLength/this.core.soundManager.buildLength:this.core.soundManager.buildLength/this.core.soundManager.loopLength,a=Math.round(t.length/o);0===a;)t+=".",a=Math.round(t.length/o);var h=this.getOther(e),i=h._locked;h._locked=a,this.batchUndo(),n=!0,this.song.independentBuild=!0,this.setText(h,this.song[h._rhythm],!0),this.song.independentBuild=!1,i||(h._locked=0),this.updateHalveDoubleButtons(h)}this.pushUndo(e._rhythm,e,this.song[e._rhythm],t),n&&this.commitUndo(),r.onbeforeunload=this.confirmLeave,this.song[e._rhythm]=t,this.reflow(e,this.song[e._rhythm]),this.setCaret(e._beatmap,s),this.updateHalveDoubleButtons(e),this.core.updateBeatLength(),this.core.recalcBeatIndex(),this.updateInfo()}else this.reflow(e,"")}},{key:"getCaret",value:function(e){var t=0,i=r.getSelection();if(i.rangeCount)for(var n=i.getRangeAt(0),s=0;s<e.childNodes.length;s++){if(n.commonAncestorContainer==e.childNodes[s])return t+=n.endOffset;t+=e.childNodes[s].textContent.length}return 0}},{key:"setCaret",value:function(e,t){for(var i=k.createRange(),n=r.getSelection(),s=0;s<e.childNodes.length;s+=2){var o=e.childNodes[s].textContent.length;if(!(o<t)){i.setStart(e.childNodes[s],t),i.collapse(!0),n.removeAllRanges(),n.addRange(i);break}t-=o}}},{key:"setLocked",value:function(e,t){var i;e._locked=t,e._lockedBtn.innerHTML=t?"&#xe906;":"&#xe907;",this.song.independentBuild||(i=this.getOther(e),t=t?this.getText(i).length:0,this.song.independentBuild=!0,this.setLocked(i,t),this.song.independentBuild=!1),this.updateHalveDoubleButtons(e)}},{key:"updateWaveform",value:function(){this.buildWaveBuff!=this.core.soundManager.buildup&&(this.buildWaveBuff=this.core.soundManager.buildup,this.buildWave=this.renderWave(this.buildWaveBuff,this.core.soundManager.buildLength)),this.loopWaveBuff!=this.core.soundManager.loop&&(this.loopWaveBuff=this.core.soundManager.loop,this.loopWave=this.renderWave(this.loopWaveBuff,this.core.soundManager.loopLength))}},{key:"renderWave",value:function(e,t){if(!e)return null;var i=k.createElement("canvas"),n=i.getContext("2d");i.height=y,i.width=Math.floor(_*t);for(var s=Math.floor(e.sampleRate/_),o=[],a=0;a<e.numberOfChannels;a++)o.push(e.getChannelData(a));for(var h=e.numberOfChannels,d=.5,l=0;l<e.length;l+=s){for(var r=0,u=0,c=0,p=0,g=void 0,g=0;g<s&&l+g<e.length;g++)for(var v=0;v<h;v++){var f=o[v][l+g];0<f?c+=f:p+=f,u<f&&(u=f),f<r&&(r=f)}var b=Math.floor(10+10*u),m=Math.floor(10+10*r);n.strokeStyle="black",n.globalAlpha="1",n.beginPath(),n.moveTo(d,b),n.lineTo(d,m),n.stroke(),c/=g*h,p/=g*h;b=Math.floor(10+10*c),m=Math.floor(10+10*p);n.strokeStyle="white",n.globalAlpha="0.5",n.beginPath(),n.moveTo(d,b),n.lineTo(d,m),n.stroke(),d+=1}return i}},{key:"drawWave",value:function(){if((this.buildWave||this.loopWave)&&this.linked){var e=this.waveCanvas.width,t=this.core.soundManager.currentTime,i=e/_/2,n=t-i,t=t+i,i=this.core.soundManager.buildLength,s=this.core.soundManager.loopLength;if(l=i?Math.max(n,-i):Math.max(n,0),d=Math.floor((l-n)*_),this.waveContext.clearRect(0,0,e,y),this.buildWave&&i&&n<0){var o=Math.floor((1-l/-i)*(this.buildWave.width-1));try{d=this.drawOneWave(this.buildWave,o,d,e)}catch(e){console.log(this.waveCanvas)}l=0}var a=[];if(this.loopWave&&s&&0<t)for(;d<e;){0===l&&a.push(d);var h=Math.floor(l/s*(this.loopWave.width-1)),d=this.drawOneWave(this.loopWave,h,d,e),l=0}this.drawWaveBar("red",e/2);for(var r=0,u=a;r<u.length;r++){var c=u[r];this.drawWaveBar("green",c)}}}},{key:"drawOneWave",value:function(e,t,i,n){n=Math.min(n-i,e.width-t);return this.waveContext.drawImage(e,t,0,n,y,i,0,n,y),i+n}},{key:"drawWaveBar",value:function(e,t){this.waveContext.strokeStyle=e,this.waveContext.lineWidth=2,this.waveContext.beginPath(),this.waveContext.moveTo(t,0),this.waveContext.lineTo(t,y),this.waveContext.stroke()}},{key:"confirmLeave",value:function(){return"Unsaved beatmap - leave anyway?"}},{key:"alert",value:function(e){this.statusMsg.classList.remove("editor__status-msg--fade"),this.statusMsg.textContent=e;this.statusMsg.offsetWidth;this.statusMsg.classList.add("editor__status-msg--fade")}},{key:"generateXML",value:function(){if(!this.song)return null;var e='  <song name="'+this.song.name+'">\n';return e+="    <title>"+this.song.title+"</title>\n",this.song.source&&(e+="    <source>"+this.song.source+"</source>\n"),e+="    <rhythm>"+this.song.rhythm+"</rhythm>\n",this.song.buildup&&(e+="    <buildup>"+this.song.buildupName+"</buildup>\n",e+="    <buildupRhythm>"+this.song.buildupRhythm+"</buildupRhythm>\n",this.song.independentBuild&&(e+="    <independentBuild>true</independentBuild>\n")),e+="  </song>\n"}},{key:"saveXML",value:function(){var e,t=this.generateXML();t&&(e="<songs>\n",e+=t,e+="</songs>\n",(t=k.createElement("a")).setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download","0x40Hues - "+this.song.name+".xml"),t.style.display="none",k.body.appendChild(t),t.click(),k.body.removeChild(t),r.onbeforeunload=null)}},{key:"copyXML",value:function(){var e=this.generateXML();if(e){var t,i=k.createElement("textarea");i.className="copybox",i.value=e,k.body.appendChild(i),i.select();try{t=k.execCommand("copy")}catch(e){t=!1}k.body.removeChild(i),t?this.alert("Beatmap XML copied to clipboard!"):this.alert("Copy failed! Try saving instead")}}}]),i}();r.HuesEditor=e}(window,document);
"use strict";!function(e,l){var o=["x Vertical blur (snare)","o Horizontal blur (bass)","- No blur","+ Blackout","¤ Whiteout","| Short blackout",": Color only","* Image only","X Vertical blur only","O Horizontal blur only",") Trippy cirle in","( Trippy circle out","~ Fade color","= Fade and change image","i Invert all colours","I Invert & change image","s Horizontal slice","S Horizontal slice and change image","v Vertical slice","V Vertical slice and change image","# Double slice","@ Double slice and change image"],i=["↑↓  Change song","←→  Change image","[N] Random song","-+  Change volume","[M] Toggle mute","[B] Restart song from build","[F] Toggle automode","[H] Toggle UI hide","[C] Character list","[S] Song list","[W] Toggle window","[R] Resource packs","[O] Options","[I] Information","[1-5] Change UI"];function r(e,a,t){var n=l.createElement("div");n.className="hues-ref__info",e.appendChild(n),(e=l.createElement("h3")).textContent=a,n.appendChild(e);var o=l.createElement("ul");t.forEach(function(e){var a=l.createElement("li");a.textContent=e,o.appendChild(a)}),n.appendChild(o)}e.populateHuesInfo=function(e,a,t){var n;t.enableWindow&&((parseInt(e)/10).toFixed(1),(n=l.createElement("div")).className="hues-ref",t=t.huesName.replace("%VERSION%",e),(e=l.createElement("div")).className="hues-about",e.innerHTML="<h1>"+t+'</h1><h2>Adapted from the <a target="_blank" href="http://0x40hues.blogspot.com">0x40 Flash</a></h2><h2>Web-ified by <a target="_blank" href="https://github.com/mon">mon</a></h2><h3>With help from <a target="_blank" href="https://github.com/kepstin/0x40hues-html5">Kepstin</a></h3>',n.appendChild(e),r(n,"Beat glossary",o),r(n,"Keyboard shortcuts",i),a.addTab("INFO",n))}}(window,document);
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}!function(r,v){var i={workersPath:"lib/workers/",respacks:[],parseQueryString:!0,respackPath:"respacks/",load:!0,autoplay:!0,overwriteLocal:!1,firstSong:null,firstImage:null,fullAuto:!0,packsURL:"https://cdn.0x40.ga/getRespacks.php",disableRemoteResources:!1,enableWindow:!0,showWindow:!1,firstWindow:"INFO",preloadPrefix:"0x",preloadBase:16,preloadMax:64,preloadTitle:"",huesName:"0x40 Hues of JS, v%VERSION%",root:null,disableKeyboard:!1,smartAlign:"on",blurAmount:"medium",blurDecay:"fast",blurQuality:"medium",currentUI:"modern",colourSet:"normal",blackoutUI:"off",playBuildups:"on",visualiser:"off",shuffleImages:"on",autoSong:"off",autoSongDelay:5,autoSongShuffle:"on",autoSongFadeout:"on",trippyMode:"off",volume:.7,skipPreloader:"off"},s={Functionality:["autoSong","autoSongShuffle","autoSongFadeout","playBuildups"],Graphics:["blurAmount","blurDecay","blurQuality","trippyMode"],Visuals:["smartAlign","shuffleImages","colourSet","visualiser"],Interface:["currentUI","blackoutUI","skipPreloader"]},m={smartAlign:{name:"Smart Align images",options:["off","on"]},blurAmount:{name:"Blur amount",options:["low","medium","high"]},blurDecay:{name:"Blur decay",options:["slow","medium","fast","faster!"]},blurQuality:{name:"Blur quality",options:["low","medium","high","extreme"]},visualiser:{name:"Spectrum analyser",options:["off","on"]},currentUI:{name:"UI style",options:["retro","v4.20","modern","xmas","hlwn","mini"]},colourSet:{name:"Colour set",options:["normal","pastel","v4.20"]},blackoutUI:{name:"Blackout affects UI",options:["off","on"]},playBuildups:{name:"Play buildups",options:["off","once","on"]},autoSong:{name:"AutoSong",options:["off","loop","time",{type:"varText",text:function(){return"off"==this.autoSong?"":"after"}},{type:"input",variable:"autoSongDelay",inputType:"int",visiblity:function(){return"off"!=this.autoSong}},{type:"varText",text:function(){var e="";switch(this.autoSong){case"loop":e="loop";break;case"time":e="min";break;case"off":default:return""}return 1<this.autoSongDelay&&(e+="s"),e}}]},autoSongShuffle:{name:"AutoSong shuffle",options:["off","on"]},autoSongFadeout:{name:"AutoSong fade out",options:["off","on"]},trippyMode:{name:"Trippy Mode",options:["off","on"]},shuffleImages:{name:"Shuffle images",options:["off","on"]},skipPreloader:{name:"Skip preloader warning",options:["off","on"]}},e=function(){function o(e){_classCallCheck(this,o),this.eventListeners={updated:[]};for(var t in"1"!=localStorage.settingsVersion&&(localStorage.clear(),localStorage.settingsVersion="1"),this.hasUI=!1,this.settingCheckboxes={},this.textCallbacks=[],this.visCallbacks=[],this.ephemerals={},i)i.hasOwnProperty(t)&&(Object.defineProperty(this,t,{set:this.makeSetter(t),get:this.makeGetter(t)}),void 0!==e[t]&&(e.overwriteLocal?this[t]=e[t]:this.ephemerals[t]=e[t]));if(this.parseQueryString){var n,a=this.getQuerySettings();for(n in i)void 0!==a[n]&&"respacks"!=n&&(this.ephemerals[n]=a[n]);this.respacks=this.respacks.concat(a.respacks)}}return _createClass(o,[{key:"getQuerySettings",value:function(){for(var e={respacks:[]},t=r.location.search.substring(1).split("&"),n=0;n<t.length;n++){var a=t[n].split("="),o=decodeURIComponent(a[1]);if("packs"==a[0]||"respacks"==a[0])for(var i=o.split(","),s=0;s<i.length;s++)e.respacks.push(this.respackPath+i[s]);else"song"==a[0]?e.firstSong=o:("true"!==o&&"false"!==o||(o="true"==o),e[a[0]]=o)}return e}},{key:"initUI",value:function(e){var p=this,t=v.createElement("div");t.className="hues-options";function f(e,t){this.value=this.value.replace(/\D/g,""),""===this.value||this.value<1?this.value="":(e[t]=this.value,e.updateConditionals(),e.callEventListeners("updated"))}for(var n in s)if(s.hasOwnProperty(n)){var h=v.createElement("div");h.textContent=n,h.className="settings-category";for(var d=s[n],a=0;a<d.length;a++)!function(e){var t=d[e],e=v.createElement("div"),n=m[t];e.textContent=n.name,e.className="settings-individual";var a=v.createElement("div");a.className="settings-buttons";for(var o=0;o<n.options.length;o++){var i,s=n.options[o];if("string"==typeof s){var r=v.createElement("input");(p.settingCheckboxes[t+"-"+s]=r).className="settings-checkbox",r.type="radio",r.value=s;for(var l=0,u=t+"-"+s+"-";v.getElementById(u+l);)l++;r.name=t+"-"+l,r.id=u+l,p[t]==s&&(r.checked=!0),r.onclick=function(e){e[t]=this.value}.bind(r,p),a.appendChild(r);var c=v.createElement("label");c.className="settings-label",c.htmlFor=r.id,c.textContent=s.toUpperCase(),a.appendChild(c)}else"varText"==s.type?((i=v.createElement("span")).textContent=s.text.bind(p)(),a.appendChild(i),p.textCallbacks.push({func:s.text.bind(p),element:i})):"input"==s.type&&((i=v.createElement("input")).setAttribute("type","text"),i.className="settings-input",i.value=p[s.variable],"int"==s.inputType&&(i.oninput=f.bind(i,p,s.variable)),i.autofocus=!1,a.appendChild(i),s.visiblity&&(p.visCallbacks.push({func:s.visiblity.bind(p),element:i}),i.style.visibility=s.visiblity.bind(p)()?"visible":"hidden"))}e.appendChild(a),h.appendChild(e)}(a);t.appendChild(h)}e.addTab("OPTIONS",t),this.hasUI=!0}},{key:"makeGetter",value:function(e){var t=this;return function(){return i.hasOwnProperty(e)?(void 0!==t.ephemerals[e]?t.ephemerals:void 0!==localStorage[e]?localStorage:i)[e]:(console.log("WARNING: Attempted to fetch invalid setting:",e),null)}}},{key:"makeSetter",value:function(n){var a=this;return function(e){if(a.isEphemeral(n))a.ephemerals[n]=e;else{var t=m[n];if(!t||-1==t.options.indexOf(e))return console.log(e,"is not a valid value for",n),!1;try{a.settingCheckboxes[n+"-"+e].checked=!0}catch(e){}localStorage[n]=e,a.ephemerals[n]=void 0}return a.updateConditionals(),a.callEventListeners("updated"),!0}}},{key:"isEphemeral",value:function(e){return void 0===m[e]}},{key:"updateConditionals",value:function(){for(var e=0;e<this.textCallbacks.length;e++){var t=this.textCallbacks[e];t.element.textContent=t.func()}for(var n=0;n<this.visCallbacks.length;n++){var a=this.visCallbacks[n];a.element.style.visibility=a.func()?"visible":"hidden"}}},{key:"callEventListeners",value:function(e){var t=Array.prototype.slice.call(arguments,1);this.eventListeners[e].forEach(function(e){e.apply(null,t)})}},{key:"addEventListener",value:function(e,t){if(e=e.toLowerCase(),void 0===this.eventListeners[e])throw Error("Unknown event: "+e);this.eventListeners[e].push(t)}},{key:"removeEventListener",value:function(e,t){if(e=e.toLowerCase(),void 0===this.eventListeners[e])throw Error("Unknown event: "+e);this.eventListeners[e]=this.eventListeners[e].filter(function(e){return e!==t})}}]),o}();r.HuesSettings=e}(window,document);
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _get(e,t,i){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){e=_superPropBase(e,t);if(e){t=Object.getOwnPropertyDescriptor(e,t);return t.get?t.get.call(i):t.value}})(e,t,i||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(i){var s=_isNativeReflectConstruct();return function(){var e,t=_getPrototypeOf(i);return _possibleConstructorReturn(this,s?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}!function(n,l){var e=function(){function i(e,t){_classCallCheck(this,i),e&&(this.root=l.createElement("div"),this.root.className=t||this.constructor.name,e.appendChild(this.root),this.root.style.visibility="hidden",this.core=null,this.imageName=null,this.imageLink=null,this.songName=null,this.songLink=null,this.hueName=null,this.imagePrev=null,this.imageNext=null,this.songPrev=null,this.songNext=null,this.beatCount=null,this.timer=null,this.xBlur=null,this.yBlur=null,this.settingsToggle=null,this.hideToggle=null,this.callbacks=[],this.listContainer=null,this.visualiserContainer=null,this.hidden=!1,this.initUI())}return _createClass(i,[{key:"addCoreCallback",value:function(e,t){this.callbacks.push({name:e,func:t})}},{key:"initUI",value:function(){var e=this,t=l.createElement("div");this.imageName=t,this.imageLink=l.createElement("a"),this.imageLink.target="_blank",this.imageName.appendChild(this.imageLink);t=l.createElement("div");this.songName=t,this.songLink=l.createElement("a"),this.songLink.target="_blank",this.songName.appendChild(this.songLink);t=l.createElement("div");this.hueName=t;t=l.createElement("div");t.textContent="<",t.onclick=function(){e.core.previousImage()},this.imagePrev=t;t=l.createElement("div");t.textContent=">",t.onclick=function(){e.core.nextImage()},this.imageNext=t;t=l.createElement("div");t.textContent="<",(this.songPrev=t).onclick=function(){e.core.previousSong()};t=l.createElement("div");t.textContent=">",t.onclick=function(){e.core.nextSong()},this.songNext=t;t=l.createElement("div");t.textContent="SONGS",t.onclick=function(){e.core.toggleSongList()},this.songList=t;t=l.createElement("div");t.textContent="IMAGES",t.onclick=function(){e.core.toggleImageList()},this.imageList=t,this.timer=l.createElement("div"),this.timer.textContent="T=$0x00000",this.beatCount=l.createElement("div"),this.beatCount.textContent="B=$0x0000",this.xBlur=l.createElement("div"),this.xBlur.textContent="X=$0x00",this.yBlur=l.createElement("div"),this.yBlur.textContent="Y=$0x00",this.settingsToggle=l.createElement("div"),this.settingsToggle.innerHTML="&#xe900;",this.settingsToggle.className="hues-icon",this.settingsToggle.onclick=function(){e.core.window.toggle()},this.hideToggle=l.createElement("div"),this.hideToggle.innerHTML="&#x25BC;",this.hideToggle.onclick=function(){e.toggleHide()},this.listContainer=l.createElement("div"),this.visualiserContainer=l.createElement("div"),this.addCoreCallback("newsong",this.newSong.bind(this)),this.addCoreCallback("newimage",this.newImage.bind(this)),this.addCoreCallback("newcolour",this.newColour.bind(this)),this.addCoreCallback("blurupdate",this.blurUpdated.bind(this)),this.addCoreCallback("time",this.updateTime.bind(this)),this.addCoreCallback("invert",this.invert.bind(this)),this.resizeHandler=this.resize.bind(this)}},{key:"connectCore",value:function(t){this.core=t,this.root.style.visibility="visible",t.resourceManager.hasUI&&this.listContainer.appendChild(t.resourceManager.listView),this.visualiserContainer.appendChild(this.core.visualiser),this.callbacks.forEach(function(e){t.addEventListener(e.name,e.func)}),n.addEventListener("resize",this.resizeHandler),this.resizeHandler()}},{key:"disconnect",value:function(){var t=this;for(this.callbacks.forEach(function(e){t.core.removeEventListener(e.name,e.func)}),this.core=null,this.root.style.visibility="hidden";this.listContainer.firstElementChild;)this.listContainer.removeChild(this.listContainer.firstElementChild);for(;this.visualiserContainer.firstElementChild;)this.visualiserContainer.removeChild(this.visualiserContainer.firstElementChild);n.removeEventListener("resize",this.resizeHandler)}},{key:"show",value:function(){this.root.style.visibility="visible"}},{key:"hide",value:function(){this.root.style.visibility="hidden"}},{key:"toggleHide",value:function(){this.hidden=!this.hidden,this.hidden?this.root.classList.add("hues-ui--hidden"):this.root.classList.remove("hues-ui--hidden")}},{key:"resize",value:function(){}},{key:"updateVolume",value:function(e){}},{key:"newSong",value:function(e){e&&(this.songLink.textContent=e.title.toUpperCase(),this.songLink.href=e.source)}},{key:"newImage",value:function(e){var t;e&&(t=e.fullname||e.name,this.imageLink.textContent=t.toUpperCase(),this.imageLink.href=e.source||"")}},{key:"newColour",value:function(e){this.hueName.textContent=e.n.toUpperCase()}},{key:"blurUpdated",value:function(e,t){e=Math.floor(255*e),t=Math.floor(255*t),this.xBlur.textContent="X="+this.intToHex(e,2),this.yBlur.textContent="Y="+this.intToHex(t,2)}},{key:"updateTime",value:function(e){e=Math.floor(1e3*e),this.timer.textContent="T="+this.intToHex(e,5)}},{key:"intToHex",value:function(e,t){for(var i=Math.abs(e).toString(16);i.length<t;)i="0"+i;return(e<0?"-":"$")+"0x"+i}},{key:"invert",value:function(e){e?this.root.classList.add("inverted"):this.root.classList.remove("inverted")}}]),i}(),t=function(){_inherits(s,e);var i=_createSuper(s);function s(e,t){return _classCallCheck(this,s),i.call(this,e,t||"RetroUI")}return _createClass(s,[{key:"initUI",value:function(){var e=this;_get(_getPrototypeOf(s.prototype),"initUI",this).call(this);var t=l.createElement("div");t.className="hues-r-container",this.root.appendChild(t),this.container=t,this.mode=l.createElement("div"),t.appendChild(this.mode),t.appendChild(this.imageName),t.appendChild(this.timer),t.appendChild(this.beatCount),t.appendChild(this.xBlur),t.appendChild(this.yBlur),this.colourIndex=l.createElement("div"),this.colourIndex.textContent="C=$0x00",t.appendChild(this.colourIndex),this.version=l.createElement("div"),t.appendChild(this.version),t.appendChild(this.hueName),t.appendChild(this.songName),this.beatBar=l.createElement("div"),t.appendChild(this.beatBar),this.controls=l.createElement("div"),this.controls.className="hues-r-controls";t=l.createElement("div");this.imageModeManual=l.createElement("div"),this.imageModeManual.textContent="NORMAL",this.imageModeManual.onclick=function(){e.core.setIsFullAuto(!1)},this.imageModeManual.className="hues-r-manualmode hues-r-button",this.imageModeAuto=l.createElement("div"),this.imageModeAuto.textContent="FULL AUTO",this.imageModeAuto.onclick=function(){e.core.setIsFullAuto(!0)},this.imageModeAuto.className="hues-r-automode hues-r-button",t.appendChild(this.imageModeManual),t.appendChild(this.imageModeAuto),this.imagePrev.className="hues-r-button",this.imageNext.className="hues-r-button",this.songPrev.className="hues-r-button",this.songNext.className="hues-r-button",this.controls.appendChild(this.imagePrev),this.controls.appendChild(t),this.controls.appendChild(this.imageNext),this.songList.className="hues-r-songs hues-r-button",this.controls.appendChild(this.songPrev),this.controls.appendChild(this.songList),this.controls.appendChild(this.songNext),this.root.appendChild(this.controls);t=l.createElement("div");t.className="hues-r-subcontrols",t.appendChild(this.settingsToggle),this.imageList.textContent="C",t.appendChild(this.imageList),t.appendChild(this.hideToggle),this.subControls=t,this.root.appendChild(t),this.hideRestore=l.createElement("div"),this.hideRestore.className="hues-r-hiderestore",this.hideRestore.innerHTML="&#x25B2;",this.hideRestore.onclick=function(){e.toggleHide()},this.root.appendChild(this.hideRestore),this.listContainer.className="hues-r-listcontainer",this.root.appendChild(this.listContainer),this.visualiserContainer.className="hues-r-visualisercontainer",this.root.appendChild(this.visualiserContainer),this.addCoreCallback("beat",this.beat.bind(this)),this.addCoreCallback("newmode",this.newMode.bind(this))}},{key:"toggleHide",value:function(){this.hidden=!this.hidden,this.hidden?(this.subControls.classList.add("hues-ui--hidden"),this.controls.classList.add("hues-ui--hidden"),this.container.classList.add("hues-ui--hidden"),this.hideRestore.classList.add("hues-ui--hidden")):(this.subControls.classList.remove("hues-ui--hidden"),this.controls.classList.remove("hues-ui--hidden"),this.container.classList.remove("hues-ui--hidden"),this.hideRestore.classList.remove("hues-ui--hidden"))}},{key:"connectCore",value:function(e){_get(_getPrototypeOf(s.prototype),"connectCore",this).call(this,e),this.version.textContent="V=$"+e.versionHex}},{key:"newMode",value:function(e){this.mode.textContent="M="+(e?"FULL AUTO":"NORMAL")}},{key:"newImage",value:function(e){e&&(this.imageLink.textContent="I="+e.name.toUpperCase(),this.imageLink.href=e.source)}},{key:"newColour",value:function(e){_get(_getPrototypeOf(s.prototype),"newColour",this).call(this,e),this.colourIndex.textContent="C="+this.intToHex(this.core.colourIndex,2)}},{key:"beat",value:function(e,t){e=e.slice(1);this.beatBar.textContent=">>"+e,this.beatCount.textContent="B="+this.intToHex(t,4)}},{key:"resize",value:function(){this.core.visualiser.width=this.visualiserContainer.offsetWidth,this.core.resizeVisualiser()}}]),s}(),i=function(){_inherits(s,t);var i=_createSuper(s);function s(e,t){return _classCallCheck(this,s),i.call(this,e,t||"MinimalUI")}return _createClass(s,[{key:"initUI",value:function(){_get(_getPrototypeOf(s.prototype),"initUI",this).call(this),this.root.removeChild(this.controls),this.root.removeChild(this.subControls),this.container.removeChild(this.beatBar),this.container.innerHTML="",this.container.appendChild(this.beatBar)}}]),s}(),s=function(){_inherits(s,t);var i=_createSuper(s);function s(e,t){return _classCallCheck(this,s),(t=i.call(this,e,t||"WeedUI")).xVariance=10,t.yVariance=20,t}return _createClass(s,[{key:"initUI",value:function(){_get(_getPrototypeOf(s.prototype),"initUI",this).call(this),this.container.removeChild(this.beatBar),this.controls.className="hues-w-controls",this.subControls.className="hues-w-subcontrols";var e=l.createElement("div");e.className="hues-w-beatbar",this.root.appendChild(e),this.beatBar=e;var t=l.createElement("div");t.className="hues-w-beatleft",e.appendChild(t),this.beatLeft=t;t=l.createElement("div");t.className="hues-w-beatright",e.appendChild(t),this.beatRight=t,this.imageModeManual.textContent="ONE",this.imageModeAuto.textContent="MANY",this.visualiserContainer.className+=" hues-w-visualisercontainer"}},{key:"toggleHide",value:function(){_get(_getPrototypeOf(s.prototype),"toggleHide",this).call(this,this),this.hidden?this.beatBar.classList.add("hues-ui--hidden"):this.beatBar.classList.remove("hues-ui--hidden")}},{key:"beat",value:function(e,t){var i=e.slice(1);this.beatLeft.textContent=i,this.beatRight.textContent=i,this.beatCount.textContent="B="+this.intToHex(t,4),-1!=["x","o","X","O"].indexOf(e[0])&&((i=l.createElement("div")).className="hues-w-beataccent",t="rotate("+this.round10(15-30*Math.random())+"deg) translate("+this.round10(-this.xVariance/2+Math.random()*this.xVariance)+"px, "+this.round10(30-this.yVariance/2+Math.random()*this.yVariance)+"px)",i.style.MozTransform=t,i.style.webkitTransform=t,i.style.transform=t,i.textContent=e[0].toUpperCase(),this.root.appendChild(i),n.setTimeout(this.removeBeat.bind(this,i),1500))}},{key:"round10",value:function(e){return Math.round(10*e)/10}},{key:"removeBeat",value:function(e){this.root.removeChild(e)}}]),s}(),a=function(){_inherits(o,e);var i=_createSuper(o);function o(e,t){return _classCallCheck(this,o),(t=i.call(this,e,t||"ModernUI")).textSize_normal=0,t.textSize_small=0,t.songLink_size=0,t.imageLink_size=0,t.currentBeat=".",t.hidden=0,t}return _createClass(o,[{key:"initUI",value:function(){var e=this;_get(_getPrototypeOf(o.prototype),"initUI",this).call(this),this.imageName.className="hues-m-imagename",this.songName.className="hues-m-songtitle";var t=l.createElement("div");t.className="hues-m-controls",this.root.appendChild(t),(this.controls=t).appendChild(this.imageName),t.appendChild(this.songName);var i=l.createElement("div");i.className="hues-m-leftbox",t.appendChild(i),this.leftBox=i,this.hueName.className="hues-m-huename",i.appendChild(this.hueName);var s=l.createElement("div");s.className="hues-m-vol-cluster",i.appendChild(s),this.settingsToggle.className+=" hues-m-cog",s.appendChild(this.settingsToggle),this.hideToggle.className="hues-m-hide",s.appendChild(this.hideToggle);var n=l.createElement("div");n.className="hues-m-vol-bar",this.volBar=n,s.appendChild(n);i=l.createElement("div");i.textContent="VOL",i.className="hues-m-vol-label",i.onclick=function(){e.core.soundManager.toggleMute()},n.appendChild(i),this.volLabel=i,this.infoToggle=l.createElement("div"),this.infoToggle.innerHTML="?",this.infoToggle.className="hues-m-question",this.infoToggle.onclick=function(){e.core.window.selectTab("INFO")},s.appendChild(this.infoToggle);var a=l.createElement("input");a.type="range",a.min=0,a.max=1,a.step=.1,n.appendChild(a),(this.volInput=a).oninput=function(){e.core.soundManager.setVolume(parseFloat(a.value))};i=l.createElement("div");i.className="hues-m-rightbox",t.appendChild(i),this.rightBox=i;s=l.createElement("div");s.className="hues-m-controlblock",this.songBlock=s,this.songList.className="hues-m-songbutton";n=l.createElement("div");n.className="hues-m-controlbuttons",this.songPrev.className="hues-m-prevbutton",this.songNext.className="hues-m-nextbutton",this.songShuffle=l.createElement("div"),this.songShuffle.innerHTML="&#xe903;",this.songShuffle.className="hues-m-actbutton hues-icon",this.songShuffle.onclick=function(){e.core.randomSong()},s.appendChild(this.songList),n.appendChild(this.songPrev),n.appendChild(this.songShuffle),n.appendChild(this.songNext),s.appendChild(n),i.appendChild(s);n=l.createElement("div");n.className="hues-m-controlblock",this.imageList.className="hues-m-songbutton",this.imageBlock=n;s=l.createElement("div");s.className="hues-m-controlbuttons",this.imageMode=l.createElement("div"),this.imageMode.innerHTML="&#xe901;",this.imageMode.className="hues-m-actbutton hues-icon",this.imageMode.onclick=function(){e.core.toggleFullAuto()},this.imagePrev.className="hues-m-prevbutton",this.imageNext.className="hues-m-nextbutton",n.appendChild(this.imageList),s.appendChild(this.imagePrev),s.appendChild(this.imageMode),s.appendChild(this.imageNext),n.appendChild(s),i.appendChild(n);i=l.createElement("div");i.className="hues-m-leftinfo";n=l.createElement("div");n.className="hues-m-rightinfo",i.appendChild(this.xBlur),i.appendChild(this.yBlur),n.appendChild(this.timer),n.appendChild(this.beatCount),this.rightInfo=n,this.leftInfo=i,t.appendChild(i),t.appendChild(n),this.visualiserContainer.className="hues-m-visualisercontainer",t.appendChild(this.visualiserContainer);n=l.createElement("div");n.className="hues-m-beatbar",this.root.appendChild(n),this.beatBar=n;t=l.createElement("div");t.className="hues-m-beatleft",n.appendChild(t),this.beatLeft=t;t=l.createElement("div");t.className="hues-m-beatright",n.appendChild(t),this.beatRight=t;t=l.createElement("div");t.className="hues-m-beatcenter",this.root.appendChild(t),this.beatCenter=t,this.hideRestore=l.createElement("div"),this.hideRestore.className="hues-m-hiderestore",this.hideRestore.onclick=function(){e.toggleHide()},this.root.appendChild(this.hideRestore),this.listContainer.className="hues-m-listcontainer",this.root.appendChild(this.listContainer),this.addCoreCallback("beat",this.beat.bind(this)),this.addCoreCallback("newmode",this.newMode.bind(this))}},{key:"toggleHide",value:function(){switch(this.beatBar.classList.remove("hues-ui--hidden"),this.beatCenter.classList.remove("hues-ui--hidden"),this.controls.classList.remove("hues-ui--hidden"),this.hideRestore.classList.remove("hues-ui--hidden"),this.hidden){case 1:this.beatBar.classList.add("hues-ui--hidden"),this.beatCenter.classList.add("hues-ui--hidden");case 0:this.controls.classList.add("hues-ui--hidden"),this.hideRestore.classList.add("hues-ui--hidden")}this.hidden=(this.hidden+1)%3}},{key:"updateVolume",value:function(e){this.volInput.value=e,this.volLabel.textContent=0===e?"(VOL)":"VOL"}},{key:"newMode",value:function(e){this.imageMode.innerHTML=e?"&#xe902;":"&#xe901;"}},{key:"beat",value:function(e,t){this.currentBeat=e[0];e=e.slice(1);if(this.beatLeft.textContent=e,this.beatRight.textContent=e,"."!=this.currentBeat){for(;this.beatCenter.firstElementChild;)this.beatCenter.removeChild(this.beatCenter.firstElementChild);e=this.beatCenter.ownerDocument.createElement("span");e.textContent=this.currentBeat,this.beatCenter.appendChild(e)}this.beatCount.textContent="B="+this.intToHex(t,4)}},{key:"textWidth",value:function(e){for(var t=this.songLink,i=t.innerHTML,s="",n=0;n<100;n++)s+="&nbsp;";t.innerHTML=s,t.className=e;e=t.offsetWidth/100;return t.innerHTML=i,e}},{key:"resize",value:function(){this.textSize_normal=this.textWidth(""),this.textSize_small=this.textWidth("small"),this.songLink_size=this.songName.clientWidth,this.imageLink_size=this.imageName.clientWidth,this.resizeSong(),this.resizeImage(),this.core.visualiser.width=this.controls.offsetWidth,this.core.resizeVisualiser()}},{key:"resizeElement",value:function(e,t){var i=e.textContent.length;i*this.textSize_normal<t?e.className="":i*this.textSize_small<t?e.className="small":e.className="x-small"}},{key:"resizeSong",value:function(){this.resizeElement(this.songLink,this.songLink_size)}},{key:"resizeImage",value:function(){this.resizeElement(this.imageLink,this.imageLink_size)}},{key:"newSong",value:function(e){_get(_getPrototypeOf(o.prototype),"newSong",this).call(this,e),e&&this.resizeSong()}},{key:"newImage",value:function(e){_get(_getPrototypeOf(o.prototype),"newImage",this).call(this,e),e&&this.resizeImage()}}]),o}(),o=function(){_inherits(h,a);var s=_createSuper(h);function h(e,t){var i;_classCallCheck(this,h),(i=s.call(this,e,t||"XmasUI")).initSnow(),i.invert(!0),i.controls.removeChild(i.leftBox),i.controls.removeChild(i.rightBox),i.controls.removeChild(i.rightInfo),i.controls.removeChild(i.leftInfo),i.leftBox=null,i.rightBox=null,i.hueName=null,i.xBlur=null,i.yBlur=null,i.timer=null,i.controls.className+=" hues-x-controls",i.beatBar.className+=" hues-x-beatbar",i.lights=[];e=l.createElement("div");e.className="hues-x-wires";var n=l.createElement("div");n.className="hues-x-wiresleft",r.forEach(function(e,t,i){var s=this.newLight(e,n);s.style.transform="rotate("+e.angle+"deg)",s.style.left=e.x+"px",s.style.top=e.y+"px",this.lights.push(s)},_assertThisInitialized(i));var a=l.createElement("div");a.className="hues-x-wiresright",c.forEach(function(e,t,i){var s=this.newLight(e,a);s.style.transform="rotate("+-e.angle+"deg)",s.style.right=e.x+"px",s.style.top=e.y+"px",this.lights.push(s)},_assertThisInitialized(i));t=l.createElement("div");t.className="hues-x-wiresbottomhelper";var o=l.createElement("div");return o.className="hues-x-wiresbottom",u.forEach(function(e,t,i){var s=this.newLight(e,o);s.style.transform="rotate("+e.angle+"deg)",s.style.left=e.x+"px",s.style.bottom=e.y+"px",this.lights.push(s)},_assertThisInitialized(i)),e.appendChild(n),e.appendChild(a),t.appendChild(o),e.appendChild(t),i.root.appendChild(e),i.visualiserContainer.className="hues-x-visualisercontainer",i.controls.removeChild(i.visualiserContainer),i.beatBar.appendChild(i.visualiserContainer),i}return _createClass(h,[{key:"invert",value:function(e){_get(_getPrototypeOf(h.prototype),"invert",this).call(this,e),this.snowContext.fillStyle=e?"rgba(0, 0, 0, 0.8)":"rgba(255, 255, 255, 0.8)"}},{key:"connectCore",value:function(e){_get(_getPrototypeOf(h.prototype),"connectCore",this).call(this,e),this.startSnow()}},{key:"disconnect",value:function(){this.stopSnow(),_get(_getPrototypeOf(h.prototype),"disconnect",this).call(this)}},{key:"lightOn",value:function(e){e.on.className="hues-x-lighton",e.off.className="hues-x-lightoff"}},{key:"lightOff",value:function(e){e.on.className="hues-x-lighton off",e.off.className="hues-x-lightoff off"}},{key:"lightFadeOut",value:function(e){e.on.className="hues-x-lighton hues-x-fade off",e.off.className="hues-x-lightoff hues-x-fade off"}},{key:"lightRecolour",value:function(e){var t=-56*Math.floor(7*Math.random());e.on.style.backgroundPosition=t+"px 0",e.off.style.backgroundPosition=t+"px 0"}},{key:"randomLight",value:function(e){.5<=Math.random()?this.lightOn(e):this.lightOff(e)}},{key:"newLight",value:function(e,t){var i=l.createElement("div");i.className="hues-x-light";var s=l.createElement("div"),n=l.createElement("div"),a=l.createElement("div");return s.appendChild(n),s.appendChild(a),i.appendChild(s),t.appendChild(i),i.on=n,i.off=a,i.bulb=s,this.randomLight(i),this.lightRecolour(i),i}},{key:"beat",value:function(e,t){_get(_getPrototypeOf(h.prototype),"beat",this).call(this,e,t),"."!=this.currentBeat&&this.lights.forEach(function(e,t,i){switch(this.currentBeat){case":":this.lightOn(e),this.lightRecolour(e);break;case"+":this.lightFadeOut(e);break;default:this.randomLight(e)}},this)}},{key:"initSnow",value:function(){this.snowCanvas=l.createElement("canvas"),this.snowContext=this.snowCanvas.getContext("2d"),this.snowCanvas.width=1280,this.snowCanvas.height=720,this.snowCanvas.style.display="none",this.snowCanvas.className="hues-canvas hues-x-snow",this.root.appendChild(this.snowCanvas),this.snowing=!1,this.maxSnow=30,this.snowAngle=0,this.lastSnow=0,this.snowflakes=[],this.addCoreCallback("frame",this.drawSnow.bind(this))}},{key:"startSnow",value:function(){this.snowing=!0,this.snowCanvas.style.display="block";var e=this.snowCanvas.height,t=this.snowCanvas.width;this.snowAngle=0,this.snowflakes=[];for(var i=0;i<this.maxSnow;i++)this.snowflakes.push({x:Math.random()*t,y:Math.random()*e,r:4*Math.random()+1,d:25*Math.random()});this.lastSnow=Date.now()/1e3}},{key:"stopSnow",value:function(){this.snowing=!1,this.snowCanvas.style.display="none"}},{key:"drawSnow",value:function(){var e=this.snowCanvas.width,t=this.snowCanvas.height,i=Date.now()/1e3,s=this.lastSnow-i;this.lastSnow=i,this.snowContext.clearRect(0,0,e,t),this.snowContext.beginPath();for(var n=0;n<this.maxSnow;n++){var a=this.snowflakes[n];this.snowContext.moveTo(a.x,a.y),this.snowContext.arc(a.x,a.y,a.r,0,2*Math.PI,!0)}this.snowContext.fill(),this.snowAngle+=s/6;for(var o=0;o<this.maxSnow;o++){var h=this.snowflakes[o];h.y+=Math.cos(this.snowAngle+h.d)+1+h.r/2,h.x+=2*Math.sin(this.snowAngle),(h.x>e+5||h.x<-5||h.y>t)&&(0<o%3?this.snowflakes[o]={x:Math.random()*e,y:-10,r:h.r,d:h.d}:0<Math.sin(this.snowAngle)?this.snowflakes[o]={x:-5,y:Math.random()*t,r:h.r,d:h.d}:this.snowflakes[o]={x:e+5,y:Math.random()*t,r:h.r,d:h.d})}}},{key:"resize",value:function(){_get(_getPrototypeOf(h.prototype),"resize",this).call(this);var e=n.innerWidth/n.innerHeight,t=this.snowContext.fillStyle;this.snowCanvas.width=Math.ceil(720*e),this.snowContext.fillStyle=t}},{key:"newColour",value:function(e){}},{key:"blurUpdated",value:function(e,t){}},{key:"updateTime",value:function(e){}}]),h}(),h=function(){_inherits(s,a);var i=_createSuper(s);function s(e,t){return _classCallCheck(this,s),(t=i.call(this,e,t||"HalloweenUI")).invert(!0),t}return _createClass(s,[{key:"initUI",value:function(){_get(_getPrototypeOf(s.prototype),"initUI",this).call(this),this.controls.className+=" hues-h-controls",this.beatBar.className+=" hues-h-beatbar",this.leftBox.className+=" hues-h-leftbox",this.rightBox.className+=" hues-h-rightbox",this.volBar.className+=" hues-h-vol-bar",this.beatLeft.className+=" hues-h-text",this.beatRight.className+=" hues-h-text",this.beatCenter.className+=" hues-h-text",this.songShuffle.className+=" hues-h-text",this.songNext.className+=" hues-h-text",this.songPrev.className+=" hues-h-text",this.songList.className+=" hues-h-text",this.songName.className+=" hues-h-text",this.imageMode.className+=" hues-h-text",this.imageNext.className+=" hues-h-text",this.imagePrev.className+=" hues-h-text",this.imageList.className+=" hues-h-text",this.imageName.className+=" hues-h-text",this.hueName.className+=" hues-h-text",this.settingsToggle.className+=" hues-h-text",this.hideToggle.className+=" hues-h-text",this.infoToggle.className+=" hues-h-text",this.volLabel.className+=" hues-h-text",this.timer.className="hues-h-textfade",this.beatCount.className="hues-h-textfade",this.xBlur.className="hues-h-textfade",this.yBlur.className="hues-h-textfade";var e=l.createElement("div");e.className="hues-h-tombstone",this.leftBox.appendChild(e);var t=l.createElement("div");t.className="hues-h-tombstone",this.songBlock.insertBefore(t,this.songBlock.firstChild);var i=l.createElement("div");i.className="hues-h-tombstone",this.imageBlock.insertBefore(i,this.imageBlock.firstChild);e=l.createElement("div");e.className="hues-h-topleft";t=l.createElement("div");t.className="hues-h-topright";i=l.createElement("div");i.className="hues-h-bottomright",this.root.appendChild(e),this.root.appendChild(t),this.root.appendChild(i);i=l.createElement("div");i.className="hues-h-left-hand",this.beatBar.appendChild(i);i=l.createElement("div");i.className="hues-h-right-hand",this.beatBar.appendChild(i),this.vignette=l.createElement("div"),this.vignette.className="hues-h-vignette",this.root.appendChild(this.vignette)}},{key:"beat",value:function(e,t){_get(_getPrototypeOf(s.prototype),"beat",this).call(this,e,t),"."!=this.currentBeat&&((t=this.beatCenter.ownerDocument.createElement("div")).className="hues-m-beatcenter hues-h-eyes",this.beatCenter.appendChild(t))}},{key:"connectCore",value:function(e){_get(_getPrototypeOf(s.prototype),"connectCore",this).call(this,e),this.core.preloader.classList.add("hues-h-text")}},{key:"disconnect",value:function(){this.core.preloader.classList.remove("hues-h-text"),_get(_getPrototypeOf(s.prototype),"disconnect",this).call(this)}}]),s}(),r=[{angle:122.529582194,x:19.4,y:-19.35},{angle:92.5309436511,x:25.4,y:38.7},{angle:107.530202659,x:39.4,y:107.75},{angle:77.5309700777,x:20.75,y:184.8},{angle:77.5309700777,x:32.3,y:249.8},{angle:107.530202659,x:40.45,y:327.9},{angle:88.3307935055,x:35,y:410.9},{angle:107.530202659,x:54.35,y:490.95},{angle:74.9981580491,x:28.15,y:573.8},{angle:89.9973772074,x:23.45,y:675.35},{angle:107.530202659,x:21.65,y:762.6},{angle:107.530202659,x:15.8,y:842.75},{angle:92.5309436511,x:36.55,y:905.7},{angle:88.3307935055,x:31.1,y:988.7},{angle:107.530202659,x:50.45,y:1068.75},{angle:74.9981580491,x:45.75,y:1158.5},{angle:88.3307935055,x:35.85,y:1238.55}],c=[{angle:120.001009518,x:33.3,y:-29.75},{angle:90.0026227926,x:35.35,y:53.65},{angle:102.469029922,x:41.5,y:136.5},{angle:91.6692064945,x:22.15,y:216.55},{angle:72.4697973408,x:34.4,y:278.25},{angle:102.469029922,x:45.75,y:361.85},{angle:87.4699314665,x:26.65,y:426.35},{angle:72.4697973408,x:41.6,y:502.15},{angle:102.469029922,x:27.5,y:566},{angle:72.4697973408,x:7.65,y:638.45},{angle:102.469029922,x:11,y:721.25},{angle:76.1887724128,x:7.65,y:792.7},{angle:87.4690563489,x:36.15,y:850.35},{angle:102.46813454,x:16.6,y:924.3},{angle:72.4697973408,x:15.3,y:990.8},{angle:76.1887724128,x:11.95,y:1062.25},{angle:87.4690563489,x:40.45,y:1119.9},{angle:102.46813454,x:20.9,y:1193.85}],u=[{angle:32.5804579323,x:110.35,y:-12.1},{angle:3.28979777069,x:168.05,y:-5.55},{angle:17.6989154099,x:238.35,y:7.7},{angle:-12.6587029361,x:314.8,y:-10.4},{angle:-12.6587029361,x:379.4,y:1.05},{angle:17.6989154099,x:457.75,y:9.4},{angle:2.59102780115,x:540.6,y:3.75},{angle:17.6989154099,x:620.35,y:22.7},{angle:-15.134241831,x:703,y:-2.9},{angle:2.30443717424,x:804.75,y:-7.85},{angle:17.6989154099,x:892.45,y:-9.55},{angle:17.6989154099,x:971.65,y:-15.5},{angle:3.28979777069,x:1035.2,y:4.35},{angle:2.59102780115,x:1118,y:.2},{angle:17.6989154099,x:1198.05,y:18.95},{angle:-18.378894807,x:1288.2,y:14.2},{angle:-4.561224264,x:1367.9,y:4.6},{angle:32.5804579323,x:1452.6,y:-1.7},{angle:3.28979777069,x:1511.45,y:4.45},{angle:17.6989154099,x:1580.6,y:17.6},{angle:-12.6587029361,x:1656.6,y:-.95},{angle:-12.6587029361,x:1722.1,y:11.1},{angle:17.6989154099,x:1800.5,y:18.8},{angle:2.59102780115,x:1883.1,y:13},{angle:17.6989154099,x:1963,y:32.6},{angle:-15.134241831,x:2045.8,y:7},{angle:2.30443717424,x:2147.55,y:1.55},{angle:17.6989154099,x:2234.1,y:.4},{angle:17.6989154099,x:2315,y:-5.6},{angle:3.28979777069,x:2377.8,y:14.5},{angle:2.59102780115,x:2460.65,y:9.75},{angle:17.6989154099,x:2540.2,y:28.5},{angle:-18.378894807,x:2627.55,y:24.9},{angle:-4.561224264,x:2710.4,y:14.4}];n.RetroUI=t,n.WeedUI=s,n.ModernUI=a,n.XmasUI=o,n.HalloweenUI=h,n.MinimalUI=i}(window,document);
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,s){return t&&_defineProperties(e.prototype,t),s&&_defineProperties(e,s),e}!function(e,i){var t=function(){function n(e,t){var s;_classCallCheck(this,n),this.eventListeners={windowshown:[],tabselected:[]},this.hasUI=t.enableWindow,this.hasUI&&(this.window=i.createElement("div"),this.window.className="hues-win-helper",e.appendChild(this.window),(s=i.createElement("div")).className="hues-win",this.window.appendChild(s),(e=i.createElement("div")).className="hues-win__closebtn",e.onclick=this.hide.bind(this),s.appendChild(e),this.tabContainer=i.createElement("div"),this.tabContainer.className="hues-win__tabs",s.appendChild(this.tabContainer),this.contentContainer=i.createElement("div"),this.contentContainer.className="hues-win__content",s.appendChild(this.contentContainer),this.contents=[],this.tabs=[],this.tabNames=[],t.showWindow?this.show():this.hide())}return _createClass(n,[{key:"addTab",value:function(e,t){var s;this.hasUI&&((s=i.createElement("div")).textContent=e,s.className="tab-label",s.onclick=this.selectTab.bind(this,e),this.tabContainer.appendChild(s),this.tabs.push(s),this.tabNames.push(e),(e=i.createElement("div")).className="tab-content",e.appendChild(t),this.contentContainer.appendChild(e),this.contents.push(e))}},{key:"selectTab",value:function(e,t){if(this.hasUI){t||this.show();for(var s=0;s<this.tabNames.length;s++){var n=this.tabNames[s];e.toLowerCase()==n.toLowerCase()?(this.contents[s].classList.add("tab-content--active"),this.tabs[s].classList.add("tab-label--active"),this.callEventListeners("tabselected",n)):(this.contents[s].classList.remove("tab-content--active"),this.tabs[s].classList.remove("tab-label--active"))}}}},{key:"hide",value:function(){this.hasUI&&(this.window.classList.add("hidden"),this.callEventListeners("windowshown",!1))}},{key:"show",value:function(){this.hasUI&&(this.window.classList.remove("hidden"),this.callEventListeners("windowshown",!0))}},{key:"toggle",value:function(){this.hasUI&&(this.window.classList.contains("hidden")?this.show():this.hide())}},{key:"callEventListeners",value:function(e){var t=Array.prototype.slice.call(arguments,1);this.eventListeners[e].forEach(function(e){e.apply(null,t)})}},{key:"addEventListener",value:function(e,t){if(e=e.toLowerCase(),void 0===this.eventListeners[e])throw Error("Unknown event: "+e);this.eventListeners[e].push(t)}},{key:"removeEventListener",value:function(e,t){if(e=e.toLowerCase(),void 0===this.eventListeners[e])throw Error("Unknown event: "+e);this.eventListeners[e]=this.eventListeners[e].filter(function(e){return e!==t})}}]),n}();e.HuesWindow=t}(window,document);
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var s=0;s<t.length;s++){var a=t[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,s){return t&&_defineProperties(e.prototype,t),s&&_defineProperties(e,s),e}!function(a,f){var w=0,e=0,i=function(){return e++},t=function(){function s(e,t){_classCallCheck(this,s),this.core=e,this.hasUI=!1,this.resourcePacks=[],this.allSongs=[],this.allImages=[],this.enabledSongs=[],this.enabledImages=[],this.progressState=[],this.progressCallback=null,this.listView=null,this.enabledSongList=null,this.enabledImageList=null,this.packView={pack:null,name:null,creator:null,size:null,desc:null,songCount:null,imageCount:null,songList:null,imageList:null,packButtons:null,totalSongs:null,totalImages:null},this.packsView={respackList:null,remoteList:null,loadRemote:null,progressBar:null,progressStatus:null,progressCurrent:null,progressTop:null,progressPercent:null},this.currentTab=w,this.unique=i(),this.remotes=null,this.fileInput=null,this.fileParseQueue=[],e.settings.enableWindow&&(this.initUI(),t.addTab("RESOURCES",this.root))}return _createClass(s,[{key:"getSizes",value:function(e){var t=[];return e.forEach(function(a){var e=new Promise(function(t,e){var s=new XMLHttpRequest;s.open("HEAD",a,!0),s.onreadystatechange=function(){var e;this.readyState==this.DONE&&(e=parseInt(s.getResponseHeader("Content-Length")),t(e/1024/1024))},s.onerror=function(){e(Error(req.status+": Could not fetch respack at "+a))},s.send()}).catch(function(e){throw 1012==e.code?Error("Respack at URL "+a+" is restricted. Check CORS."):e});t.push(e)}),Promise.all(t)}},{key:"addAll",value:function(e,t){var s=this;t&&(this.progressCallback=t,this.progressState=Array.apply(null,Array(e.length)).map(Number.prototype.valueOf,0));for(var a=[],i=function(e,t,s){this.progressState[e]=t,this.updateProgress(s)},n=0;n<e.length;n++){var l=new Respack;a.push(l.loadFromURL(e[n],i.bind(this,n)))}return a.reduce(function(e,t){return e.then(function(){return t}).then(function(e){s.addPack(e)})},Promise.resolve())}},{key:"updateProgress",value:function(e){for(var t=0,s=0;s<this.progressState.length;s++)t+=this.progressState[s];t/=this.progressState.length,this.progressCallback(t,e)}},{key:"addPack",value:function(e){console.log("Added",e.name,"to respacks");var t=this.resourcePacks.length;this.resourcePacks.push(e),this.addResourcesToArrays(e),this.rebuildEnabled(),this.updateTotals();var s=this;this.appendListItem("respacks",e.name,"res"+t,this.packsView.respackList,function(){e.enabled=this.checked,s.rebuildEnabled()},function(e){this.selectPack(e)}.bind(this,t))}},{key:"addResourcesToArrays",value:function(e){this.allImages=this.allImages.concat(e.images),this.allSongs=this.allSongs.concat(e.songs)}},{key:"rebuildArrays",value:function(){this.allSongs=[],this.allImages=[],this.allAnimations=[];for(var e=0;e<this.resourcePacks.length;e++)this.addResourcesToArrays(this.resourcePacks[e])}},{key:"rebuildEnabled",value:function(){this.enabledSongs=[],this.enabledImages=[];for(var e=0;e<this.resourcePacks.length;e++){var t=this.resourcePacks[e];if(!0===t.enabled){for(var s=0;s<t.songs.length;s++){var a=t.songs[s];a.enabled&&-1==this.enabledSongs.indexOf(a)&&this.enabledSongs.push(a)}for(var i=0;i<t.images.length;i++){var n=t.images[i];n.enabled&&-1==this.enabledImages.indexOf(n)&&this.enabledImages.push(n)}}}if(this.hasUI){for(var l=this.enabledSongList;l.firstElementChild;)l.removeChild(l.firstElementChild);for(var r=this.enabledImageList;r.firstElementChild;)r.removeChild(r.firstElementChild);for(var o=0;o<this.enabledSongs.length;o++){var c=this.enabledSongs[o];this.appendSimpleListItem(c.title,l,function(e){this.core.setSong(e)}.bind(this,o))}for(var h=0;h<this.enabledImages.length;h++){var d=this.enabledImages[h];this.appendSimpleListItem(d.name,r,function(e){this.core.setImage(e),this.core.setIsFullAuto(!1)}.bind(this,h))}}this.updateTotals()}},{key:"removePack",value:function(e){e=this.resourcePacks.indexOf(e);-1!=e&&(this.resourcePacks.splice(e,1),this.rebuildArrays(),this.rebuildEnabled())}},{key:"removeAllPacks",value:function(){this.resourcePacks=[],this.rebuildArrays(),this.rebuildEnabled()}},{key:"getSongNames",value:function(){for(var e=[],t=0;t<this.allSongs.length;t++)e.push(this.allSongs[t]);return e}},{key:"loadLocal",value:function(){var s=this;console.log("Loading local zip(s)");for(var a=this.fileInput.files,i=Promise.resolve(),e=0;e<a.length;e++)!function(e){var t=new Respack;i=i.then(function(){return t.loadFromBlob(a[e],function(e,t){s.localProgress(e,t)})}).then(function(e){s.addPack(e),s.localComplete()})}(e);return i.then(function(){console.log("Local respack parsing complete")})}},{key:"localProgress",value:function(e,t){this.hasUI&&(this.packsView.progressStatus.textContent="Processing...",this.packsView.progressBar.style.width=100*e+"%",this.packsView.progressCurrent.textContent=t.filesLoaded,this.packsView.progressTop.textContent=t.filesToLoad,this.packsView.progressPercent.textContent=Math.round(100*e)+"%")}},{key:"localComplete",value:function(e){var t=this.packsView.progressStatus;t.textContent="Complete",a.setTimeout(function(){t.textContent="Idle"},2e3),this.packsView.progressBar.style.width="100%",this.packsView.progressCurrent.textContent="0b",this.packsView.progressTop.textContent="0b",this.packsView.progressPercent.textContent="0%"}},{key:"initUI",value:function(){var e=this;this.root=f.createElement("div"),this.root.className="respacks";var t=f.createElement("div");t.className="respacks__manager";var s=f.createElement("div");s.textContent="Current respacks",s.className="respacks__header";var a=f.createElement("div");a.className="resource-list",this.packsView.respackList=a;var i=null,n=null;this.core.settings.disableRemoteResources||((i=f.createElement("div")).textContent="Remote respacks",i.className="respacks__header",(n=f.createElement("div")).className="resource-list resource-list--fill",a.classList.add("resource-list--fill"),this.appendSimpleListItem("Click to load the list",n,this.loadRemotes.bind(this)),this.packsView.remoteList=n);var l=f.createElement("div");l.className="respacks-buttons";var r=f.createElement("div");r.className="hues-button hidden",r.textContent="LOAD REMOTE",r.onclick=this.loadCurrentRemote.bind(this);var o=f.createElement("div");o.className="hues-button",o.textContent="LOAD ZIPS",o.onclick=function(){e.fileInput.click()},l.appendChild(o),l.appendChild(r),this.packsView.loadRemote=r,this.fileInput=f.createElement("input"),this.fileInput.type="file",this.fileInput.accept="application/zip",this.fileInput.multiple=!0,this.fileInput.onchange=this.loadLocal.bind(this);var c=f.createElement("div");c.className="progress-container respacks-bottom-container";var h=f.createElement("div");h.className="progress-bar";var d=f.createElement("span");d.className="progress-bar--filled",h.appendChild(d);var p=f.createElement("div");p.textContent="Idle";var u=f.createElement("div");u.className="stat-text";var m=f.createElement("div");m.textContent="0b";var k=f.createElement("div");k.textContent="0b";o=f.createElement("div");o.textContent="0%",u.appendChild(m),u.appendChild(k),u.appendChild(o),this.packsView.progressBar=d,this.packsView.progressStatus=p,this.packsView.progressCurrent=m,this.packsView.progressTop=k,this.packsView.progressPercent=o,c.appendChild(p),c.appendChild(h),c.appendChild(u),t.appendChild(s),t.appendChild(a),this.core.settings.disableRemoteResources||(t.appendChild(i),t.appendChild(n)),t.appendChild(l),t.appendChild(c);r=f.createElement("div");r.className="respacks__display";d=f.createElement("div");d.textContent="<select a respack>",d.className="respacks__header";m=f.createElement("div");m.className="stat-text";k=f.createElement("div"),o=f.createElement("a");o.className="unstyled-link",o.textContent="<author>",k.appendChild(o),m.appendChild(k);p=f.createElement("div");p.textContent="0b",m.appendChild(p);h=f.createElement("div");h.className="respack-description",h.textContent="<no description>";u=f.createElement("div");u.className="respack-tab-container";var g=f.createElement("div");g.textContent="Songs:",g.className="respack-tab respack-tab--checked";var C=f.createElement("div");C.textContent="Images:",C.className="respack-tab";var v=f.createElement("div");v.className="resource-list respack-tab__content respack-tab__content--checked";var b=f.createElement("div");b.className="resource-list respack-tab__content",g.onclick=function(){g.classList.add("respack-tab--checked"),C.classList.remove("respack-tab--checked"),v.classList.add("respack-tab__content--checked"),b.classList.remove("respack-tab__content--checked"),e.currentTab=w},C.onclick=function(){C.classList.add("respack-tab--checked"),g.classList.remove("respack-tab--checked"),b.classList.add("respack-tab__content--checked"),v.classList.remove("respack-tab__content--checked"),e.currentTab=1};s=f.createElement("div");s.className="respacks-buttons respacks-buttons--fill invisible";a=f.createElement("div");a.textContent="ENABLE ALL",a.className="hues-button",a.onclick=this.enableAll.bind(this);i=f.createElement("div");i.textContent="INVERT",i.className="hues-button",i.onclick=this.invert.bind(this);n=f.createElement("div");n.textContent="DISABLE ALL",n.className="hues-button",n.onclick=this.disableAll.bind(this),s.appendChild(a),s.appendChild(i),s.appendChild(n);l=f.createElement("div");l.className="respacks-bottom-container";c=f.createElement("div");c.className="respacks-count-container";k=f.createElement("span");k.textContent="Total Songs:";a=f.createElement("span");a.className="respacks-counts",c.appendChild(k),c.appendChild(a);i=f.createElement("div");i.className="respacks-count-container";n=f.createElement("span");n.textContent="Total images:";k=f.createElement("span");k.className="respacks-counts",i.appendChild(n),i.appendChild(k),l.appendChild(c),l.appendChild(i),this.packView.name=d,this.packView.creator=o,this.packView.size=p,this.packView.desc=h,this.packView.songCount=g,this.packView.imageCount=C,this.packView.songList=v,this.packView.imageList=b,this.packView.packButtons=s,this.packView.totalSongs=a,this.packView.totalImages=k,r.appendChild(d),r.appendChild(m),r.appendChild(h),u.appendChild(g),u.appendChild(C),r.appendChild(u),r.appendChild(v),r.appendChild(b),r.appendChild(s),r.appendChild(l),this.root.appendChild(t),this.root.appendChild(r),this.listView=f.createElement("div"),this.enabledSongList=f.createElement("div"),this.enabledSongList.className="resource-list respacks-enabledsongs hidden",this.enabledImageList=f.createElement("div"),this.enabledImageList.className="resource-list respacks-enabledimages hidden",this.listView.appendChild(this.enabledSongList),this.listView.appendChild(this.enabledImageList),this.hasUI=!0}},{key:"hideLists",value:function(){this.hasUI&&(this.enabledSongList.classList.add("hidden"),this.enabledImageList.classList.add("hidden"))}},{key:"toggleVisible",value:function(e,t){this.hasUI&&(e.classList.contains("hidden")?e.classList.remove("hidden"):e.classList.add("hidden"),t.classList.add("hidden"))}},{key:"toggleSongList",value:function(){this.toggleVisible(this.enabledSongList,this.enabledImageList)}},{key:"toggleImageList",value:function(){this.toggleVisible(this.enabledImageList,this.enabledSongList)}},{key:"updateTotals",value:function(){this.hasUI&&(this.packView.totalSongs.textContent=this.enabledSongs.length+"/"+this.allSongs.length,this.packView.totalImages.textContent=this.enabledImages.length+"/"+this.allImages.length)}},{key:"truncateNum",value:function(e){return Math.round(100*e)/100}},{key:"selectPack",value:function(e){var t=this.resourcePacks[e];this.packView.pack=t,this.packView.packButtons.classList.remove("invisible"),this.packsView.loadRemote.classList.add("hidden"),this.packView.name.textContent=t.name,this.packView.creator.textContent=t.author,this.packView.creator.href=t.link||"";e=t.size/1024;this.packView.size.textContent=e<512?this.truncateNum(e)+"kB":this.truncateNum(e/1024)+"MB",this.packView.desc.textContent=t.description,this.packView.songCount.textContent="Songs: "+t.songs.length,this.packView.imageCount.textContent="Images: "+t.images.length;for(var s=this.packView.songList,a=this.packView.imageList;s.firstElementChild;)s.removeChild(s.firstElementChild);for(;a.firstElementChild;)a.removeChild(a.firstElementChild);for(var i=0;i<t.songs.length;i++){var n=t.songs[i];this.appendListItem("songs",n.title,"song"+i,s,this.selectResourceCallback(n),this.clickResourceCallback.bind(this,n,!0),n.enabled)}for(var l=0;l<t.images.length;l++){var r=t.images[l];this.appendListItem("images",r.name,"image"+l,a,this.selectResourceCallback(r),this.clickResourceCallback.bind(this,r,!1),r.enabled)}}},{key:"selectResourceCallback",value:function(e){var t=this;return function(){e.enabled=this.checked,t.rebuildEnabled()}}},{key:"clickResourceCallback",value:function(e,t){e.enabled||(e.enabled=!0,this.rebuildEnabled(),this.selectPack(this.resourcePacks.indexOf(this.packView.pack))),t?this.core.setSong(this.enabledSongs.indexOf(e)):(this.core.setImage(this.enabledImages.indexOf(e)),this.core.setIsFullAuto(!1))}},{key:"getEnabledTabContents",value:function(){var e=this.packView.pack;return e?this.currentTab==w?{arr:e.songs,elName:"song"}:{arr:e.images,elName:"image"}:null}},{key:"enableAll",value:function(){var e=this.getEnabledTabContents();if(e){for(var t=0;t<e.arr.length;t++)e.arr[t].enabled=!0,f.getElementById(e.elName+t+"-"+this.unique).checked=!0;this.rebuildEnabled()}}},{key:"disableAll",value:function(){var e=this.getEnabledTabContents();if(e){for(var t=0;t<e.arr.length;t++)e.arr[t].enabled=!1,f.getElementById(e.elName+t+"-"+this.unique).checked=!1;this.rebuildEnabled()}}},{key:"invert",value:function(){var e=this.getEnabledTabContents();if(e){for(var t=0;t<e.arr.length;t++)e.arr[t].enabled=!e.arr[t].enabled,f.getElementById(e.elName+t+"-"+this.unique).checked=e.arr[t].enabled;this.rebuildEnabled()}}},{key:"appendListItem",value:function(e,t,s,a,i,n,l){var r,o;this.hasUI&&(void 0===l&&(l=!0),(r=f.createElement("div")).className="respacks-listitem",(o=f.createElement("input")).type="checkbox",o.name=e,o.value=t,o.id=s+"-"+this.unique,o.checked=l,o.onclick=i,(l=f.createElement("label")).htmlFor=o.id,(i=f.createElement("span")).textContent=t,i.onclick=n,r.appendChild(o),r.appendChild(l),r.appendChild(i),a.appendChild(r))}},{key:"loadRemotes",value:function(){for(var e=this,t=this.packsView.remoteList;t.firstElementChild;)t.removeChild(t.firstElementChild);var s=this.appendSimpleListItem("Loading...",t),a=new XMLHttpRequest;a.open("GET",this.core.settings.packsURL,!0),a.responseType="json",a.onload=function(){a.response||a.onerror(),e.remotes=a.response,e.populateRemotes()},a.onerror=function(){s.textContent="Could not load list! Click to try again",s.onclick=e.loadRemotes.bind(e)},a.send()}},{key:"populateRemotes",value:function(){for(var e=this.packsView.remoteList;e.firstElementChild;)e.removeChild(e.firstElementChild);for(var t=0;t<this.remotes.length;t++)this.remotes[t].loaded=!1,this.appendSimpleListItem(this.remotes[t].name,e,function(e){this.selectRemotePack(e)}.bind(this,t))}},{key:"selectRemotePack",value:function(e){var t=this.remotes[e];this.packView.pack=t,this.packView.packButtons.classList.add("invisible"),this.packsView.loadRemote.classList.remove("hidden"),t.loaded?(this.packsView.loadRemote.classList.add("hues-button--loaded"),this.packsView.loadRemote.textContent="LOADED"):(this.packsView.loadRemote.classList.remove("hues-button--loaded"),this.packsView.loadRemote.textContent="LOAD REMOTE"),this.packView.name.textContent=t.name,this.packView.creator.textContent=t.author,this.packView.creator.href=t.link||"";e=t.size/1024;this.packView.size.textContent=e<512?this.truncateNum(e)+"kB":this.truncateNum(e/1024)+"MB",this.packView.desc.textContent=t.description,this.packView.songCount.textContent="Songs: "+t.songcount,this.packView.imageCount.textContent="Images: "+t.imagecount;for(var s=this.packView.songList,a=this.packView.imageList;s.firstElementChild;)s.removeChild(s.firstElementChild);for(;a.firstElementChild;)a.removeChild(a.firstElementChild);for(var i=0;i<t.songs.length;i++){var n=t.songs[i];this.appendSimpleListItem(n,s)}e=t.songcount-t.songs.length;0<e&&(o="... and "+e+" more song",1<e&&(o+="s"),this.appendSimpleListItem(o+".",s),this.appendSimpleListItem("Load the respack to show the rest!",s));for(var l=0;l<t.images.length;l++){var r=t.images[l];this.appendSimpleListItem(r,a)}var o,e=t.imagecount-t.images.length;0<e&&(o="... and "+e+" more image",1<e&&(o+="s"),this.appendSimpleListItem(o+".",a),this.appendSimpleListItem("Load the respack to show the rest!",a))}},{key:"loadCurrentRemote",value:function(){var s=this,e=this.packView.pack;void 0===e.loaded||e.loaded||(e.loaded=!0,this.packsView.loadRemote.className="hues-button hues-button--loaded",this.packsView.loadRemote.textContent="LOADING",this.addAll([e.url],function(e,t){s.remoteProgress(e,t)}).then(this.remoteComplete.bind(this)))}},{key:"remoteProgress",value:function(e,t){e<.5?(this.packsView.progressStatus.textContent="Downloading...",this.packsView.progressCurrent.textContent=Math.round(t.downloaded/1024)+"b",this.packsView.progressTop.textContent=Math.round(t.size/1024)+"b",this.packsView.progressBar.style.width=2*e*100+"%",this.packsView.progressPercent.textContent=Math.round(2*e*100)+"%"):(this.packsView.progressStatus.textContent="Processing...",this.packsView.progressCurrent.textContent=t.filesLoaded,this.packsView.progressTop.textContent=t.filesToLoad,this.packsView.progressBar.style.width=2*(e-.5)*100+"%",this.packsView.progressPercent.textContent=Math.round(2*(e-.5)*100)+"%")}},{key:"remoteComplete",value:function(){var e=this.packsView.progressStatus;e.textContent="Complete",a.setTimeout(function(){e.textContent="Idle"},2e3),this.packsView.loadRemote.textContent="LOADED",this.packsView.progressBar.style.width="100%",this.packsView.progressCurrent.textContent="0b",this.packsView.progressTop.textContent="0b",this.packsView.progressPercent.textContent="0%"}},{key:"appendSimpleListItem",value:function(e,t,s){var a=f.createElement("div");a.className="respacks-listitem";var i=f.createElement("span");return i.textContent=e.replace(/&amp;/g,"&"),i.onclick=s,a.appendChild(i),t.appendChild(a),i}}]),s}();a.Resources=t}(window,document);
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}!function(e){function l(){0}var r=new RegExp("\\.(mp3|ogg|wav)$","i"),i=new RegExp("\\.(png|gif|jpg|jpeg)$","i"),t=(new RegExp("(.*?)_\\d+$"),function(){function e(){_classCallCheck(this,e),this.songs=[],this.songQueue=[],this.images=[],this.imageQueue=[],this.name="<no name>",this.author="<unknown>",this.description="<no description>",this.link=null,this.size=-1,this.downloaded=-1,this.enabled=!0,this._xmlQueue=[],this.totalFiles=-1,this.progressCallback=null,this.filesToLoad=0,this.filesLoaded=0,this.loadedFromURL=!1}return _createClass(e,[{key:"updateProgress",value:function(e){var t;this.progressCallback&&(t=this.filesLoaded/this.filesToLoad,this.loadedFromURL&&(t=t/2+.5),this.progressCallback("number"==typeof e?e:t,this))}},{key:"loadFromURL",value:function(e,t){var n=this;return this.loadedFromURL=!0,t&&(this.progressCallback=t),this.getBlob(e).then(function(e){return n.loadFromBlob(e)})}},{key:"getBlob",value:function(a,e){var i=this;return e&&(this.progressCallback=e),new Promise(function(e,t){var n=new XMLHttpRequest;n.open("GET",a,!0),n.responseType="blob",n.onload=function(){200==n.status?e(n.response):t(Error(n.status+": Could not fetch respack at "+a))},n.onerror=function(){t(Error(n.status+": Could not fetch respack at "+a))},n.onprogress=function(e){e.lengthComputable&&(i.size=e.total,i.downloaded=e.loaded,e=e.loaded/e.total,i.progressCallback&&i.progressCallback(e/2,i))},n.send()}).catch(function(e){throw 1012==e.code?Error("Respack at URL "+a+" is restricted. Check CORS."):e})}},{key:"loadFromBlob",value:function(a,e){var i=this;return e&&(this.progressCallback=e),this.updateProgress(this.loadedFromURL?.5:0),new Promise(function(e,t){i.size=a.size;var n=new zip.fs.FS;n.importBlob(a,function(){e(n)},function(e){t(Error("Respack error:",e.toString()))})}).then(function(e){return i.parseZip(e)}).then(function(){return i})}},{key:"parseZip",value:function(e){var t=this,n=e.entries;this.totalFiles=0,this.filesToLoad=0;for(var a=this.filesLoaded=0;a<n.length;a++)!n[a].directory&&n[a].name&&(this.totalFiles++,this.parseFile(n[a]));return this.parseSongQueue().then(function(){return t.parseImageQueue()}).then(function(){return t.parseXML()}).then(function(){t._xmlQueue=[],console.log("Loaded",t.name,"successfully with",t.songs.length,"songs and",t.images.length,"images.")})}},{key:"parseFile",value:function(e){var t=e.name;t.match(r)?(this.songQueue.push(this.parseSong(e)),this.filesToLoad++):t.match(i)?(this.imageQueue.push(this.parseImage(e)),this.filesToLoad++):t.toLowerCase().endsWith(".xml")&&this._xmlQueue.push(this.loadXML(e))}},{key:"parseSong",value:function(n){var t=this,e=n.name.replace(r,"");if(l("parsing song: "+e),!this.containsSong(e)){var a={name:e,title:null,rhythm:null,source:null,sound:null,enabled:!0,filename:n.name,charsPerBeat:null},i=n.name.split(".").pop().toLowerCase(),s="";switch(i){case"mp3":s="audio/mpeg3";break;case"ogg":s="audio/ogg";break;case"wav":s="audio/wav";break;default:s="application/octet-stream"}return this.songs.push(a),new Promise(function(t,e){n.getBlob(s,function(e){t(e)})}).then(function(a){return new Promise(function(e,t){var n=new FileReader;n.onload=function(){e(n.result)},n.readAsArrayBuffer(a)})}).then(function(e){a.sound=e,t.filesLoaded++,t.updateProgress()})}l("WARNING: Song",e,"already exists! Conflict with",e,"and",this.getSong(e).name)}},{key:"parseSongQueue",value:function(){return this.songQueue.reduce(function(e,t){return e.then(function(){return t})},Promise.resolve())}},{key:"parseImage",value:function(e){var t,n=e.name.replace(i,"");if(a=n.match(new RegExp("^(.*)_(\\d+)$")))(t=this.getImage(a[1]))||(t={name:a[1],fullname:a[1],align:"center",bitmaps:[],frameDurations:[33],source:null,enabled:!0,animated:!0,beatsPerAnim:null},this.images.push(t));else{if(this.containsImage(n)){var a=this.getImage(n);return void console.log("WARNING: Image",n,"already exists! Conflict with",e.name,"and",a.name)}t={name:n,fullname:n,bitmap:null,align:"center",source:null,enabled:!0,filename:e.name,animated:!1},this.images.push(t)}return this.loadImage(e,t)}},{key:"loadImage",value:function(n,t){var a=this,e=n.name.split(".").pop().toLowerCase(),i="";switch(e){case"png":i="image/png";break;case"gif":i="image/gif";break;case"jpg":case"jpeg":i="image/jpeg";break;default:i="application/octet-stream"}return new Promise(function(e,t){n.getData64URI(i,e)}).then(function(e){return a.filesLoaded++,a.updateProgress(),{bitmap:e,img:t}})}},{key:"parseImageQueue",value:function(){return this.imageQueue.reduce(function(e,t){return e.then(function(){return t}).then(function(e){var t;e&&((t=new Image).src=e.bitmap,e.img.animated?e.img.bitmaps.push(t):e.img.bitmap=t)})},Promise.resolve())}},{key:"loadXML",value:function(n){return new Promise(function(t,e){n.getText(function(e){e=(e=e.replace(/&amp;/g,"&")).replace(/&/g,"&amp;");e=(new DOMParser).parseFromString(e,"text/xml");t(e)})})}},{key:"parseXML",value:function(){for(var t=this,e=0;e<this._xmlQueue.length;e++)this._xmlQueue[e]=this._xmlQueue[e].then(function(e){switch(e.documentElement.nodeName){case"songs":0<t.songs.length&&t.parseSongFile(e);break;case"images":0<t.images.length&&t.parseImageFile(e);break;case"info":t.parseInfoFile(e);break;default:console.log("XML found with no songs, images or info")}});return Promise.all(this._xmlQueue)}},{key:"parseSongFile",value:function(e){l(" - Parsing songFile");for(var t=[],n=e.documentElement.firstElementChild;n;n=n.nextElementSibling){var a,i=this.getSong(n.attributes[0].value);i?(i.title=n.getTag("title"),i.title||(i.title="<no name>",l("  WARNING!",i.name,"has no title!")),i.rhythm=n.getTag("rhythm"),i.rhythm||(i.rhythm="..no..rhythm..",l("  WARNING!!",i.name,"has no rhythm!!")),i.buildupName=n.getTag("buildup"),i.buildupName&&(l("  Finding a buildup '"+i.buildupName+"' for ",i.name),(a=this.getSong(i.buildupName))?(i.buildup=a.sound,i.buildupPlayed=!1,this.songs.splice(this.songs.indexOf(a),1)):l("  WARNING!","Didn't find a buildup '"+i.buildupName+"'!")),i.buildupRhythm=n.getTag("buildupRhythm"),i.independentBuild=n.getTag("independentBuild"),i.source=n.getTag("source"),i.charsPerBeat=parseFloat(n.getTag("charsPerBeat")),"PackShit"==this.name&&(i.forceTrim=!0),t.push(i),l("  [I] "+i.name,": '"+i.title+"' added to songs")):l("  WARNING!","songs.xml: <song> element",+n.attributes[0].value+"- no song found")}for(var s=0;s<this.songs.length;s++)-1==t.indexOf(this.songs[s])&&l("  WARNING!","We have a file for",this.songs[s].name,"but no information for it");this.songs=t}},{key:"parseInfoFile",value:function(e){l(" - Parsing infoFile");e=e.documentElement;this.name=e.getTag("name",this.name),this.author=e.getTag("author",this.author),this.description=e.getTag("description",this.description),this.link=e.getTag("link",this.link)}},{key:"parseImageFile",value:function(e){l(" - Parsing imagefile");for(var t=[],n=e.documentElement.firstElementChild;n;n=n.nextElementSibling){var a=this.getImage(n.attributes[0].value);if(a){a.fullname=n.getTag("fullname"),a.fullname||l("  WARNING!",a.name,"has no full name!"),a.source=n.getTag("source"),a.align=n.getTag("align",a.align),a.beatsPerAnim=parseFloat(n.getTag("beatsPerAnim")),a.syncOffset=parseFloat(n.getTag("syncOffset"));var i=n.getTag("frameDuration");if(i){a.frameDurations=[];for(var s=i.split(","),r=0;r<s.length;r++)a.frameDurations.push(parseInt(s[r]));for(;a.frameDurations.length<a.bitmaps.length;)a.frameDurations.push(a.frameDurations[a.frameDurations.length-1]);l("Frame durations:",a.frameDurations)}l("  [I] "+a.name,":",a.fullname,"added to images"),a.bitmap||a.bitmaps?t.push(a):l("  WARNING!!","Image",a.name,"has no bitmap nor animation frames!")}else l("  WARNING!","images.xml: no image '"+n.attributes[0].value+"' found")}for(var o=0;o<this.images.length;o++){var u=this.images[o];-1==t.indexOf(u)&&t.push(u)}t.sort(function(e,t){return e.name.localeCompare(t.name)}),this.images=t}},{key:"containsSong",value:function(e){return null!==this.getSong(e)}},{key:"containsImage",value:function(e){return null!==this.getImage(e)}},{key:"getSong",value:function(e){for(var t=0;t<this.songs.length;t++)if(e==this.songs[t].name)return this.songs[t];return null}},{key:"getImage",value:function(e){for(var t=0;t<this.images.length;t++)if(e==this.images[t].name)return this.images[t];return null}}]),e}());e.Respack=t,Element.prototype.getTag=function(e,t){e=this.getElementsByTagName(e)[0];return e?e.textContent:t||null}}(window,document);
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}!function(r){for(var t=function(){function i(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;_classCallCheck(this,i),this.eventListeners={seek:[]},this.core=t,this.playing=!1,this.playbackRate=1,this.song=null,this.initPromise=null,this.lockedPromise=null,this.locked=!0,this.context=null,this.oggSupport=!1,this.buildSource=null,this.loopSource=null,this.buildup=null,this.loop=null,this.startTime=0,this.buildLength=0,this.loopLength=0,this.gainNode=null,this.mute=!1,this.lastVol=e,this.vReady=!1,this.vBars=0,this.vTotalBars=0,this.splitter=null,this.analysers=[],this.analyserArrays=[],this.logArrays=[],this.binCutoffs=[],this.linBins=0,this.logBins=0,this.maxBinLin=0}return _createClass(i,[{key:"callEventListeners",value:function(t){var e=Array.prototype.slice.call(arguments,1);this.eventListeners[t].forEach(function(t){t.apply(null,e)})}},{key:"addEventListener",value:function(t,e){if(t=t.toLowerCase(),void 0===this.eventListeners[t])throw Error("Unknown event: "+t);this.eventListeners[t].push(e)}},{key:"removeEventListener",value:function(t,e){if(t=t.toLowerCase(),void 0===this.eventListeners[t])throw Error("Unknown event: "+t);this.eventListeners[t]=this.eventListeners[t].filter(function(t){return t!==e})}},{key:"init",value:function(){var o=this;return this.initPromise||(this.initPromise=new Promise(function(t,e){try{r.AudioContext=r.AudioContext||r.webkitAudioContext,AudioContext.prototype.suspend=AudioContext.prototype.suspend||function(){return Promise.resolve()},AudioContext.prototype.resume=AudioContext.prototype.resume||function(){return Promise.resolve()},o.context=new r.AudioContext,o.gainNode=o.context.createGain(),o.gainNode.connect(o.context.destination)}catch(t){return void e(Error("Web Audio API not supported in this browser."))}t()}).then(function(){return new Promise(function(e,t){o.context.decodeAudioData(n,function(t){o.oggSupport=!0,e()},function(t){o.oggSupport=!1,e()})})}).then(function(){return new Promise(function(e,i){var n;try{n=o.createWorker()}catch(t){return console.log(t),void i(Error("Audio Worker cannot be started - correct path set in defaults?"))}n.addEventListener("message",function(t){n.terminate(),e()},!1),n.addEventListener("error",function(){i(Error("Audio Worker cannot be started - correct path set in defaults?"))},!1),n.postMessage({ping:!0,ogg:o.oggSupport})})}).then(function(){o.locked="running"!=o.context.state})),this.initPromise}},{key:"unlock",value:function(){var o=this;return this.lockedPromise||(this.lockedPromise=new Promise(function(i,t){function n(){var t=o.context.createBuffer(1,1,22050),e=o.context.createBufferSource();e.buffer=t,e.connect(o.context.destination),e.start(0),r.removeEventListener("touchend",n),r.removeEventListener("click",n),o.core.clearMessage(),i()}r.addEventListener("touchend",n,!1),r.addEventListener("click",n,!1)}),this.lockedPromise)}},{key:"playSong",value:function(e,t,i){var n=this,o=Promise.resolve();return this.song!=e||i?(this.stop(),(this.song=e)&&e.sound?(this.gainNode.gain.cancelScheduledValues(0),this.setVolume(this.lastVol),this.mute&&this.setMute(!0),o=o.then(function(){return n.loadSong(e)}).then(function(t){return e!=n.song?Promise.reject("Song changed between load and play - this message can be ignored"):(n.buildup=t.buildup,n.buildLength=n.buildup?n.buildup.duration:0,n.loop=t.loop,n.loopLength=n.loop.duration,n.context.suspend())}).then(function(){return t?n.seek(-n.buildLength,!0):n.seek(0,!0),n.context.resume()}).then(function(){n.playing=!0})):o):o}},{key:"stop",value:function(t){this.playing&&(this.buildSource&&(this.buildSource.stop(0),this.buildSource.disconnect(),this.buildSource=null,t||(this.buildup=null)),this.loopSource.stop(0),this.loopSource.disconnect(),this.loopSource=null,t||(this.loop=null),this.vReady=!1,this.playing=!1,this.startTime=0)}},{key:"setRate",value:function(t){t=Math.max(Math.min(t,2),.25);var e=this.clampedTime;this.playbackRate=t,this.seek(e)}},{key:"seek",value:function(t,e){this.song&&(this.callEventListeners("seek"),t=Math.min(Math.max(t,-this.buildLength),this.loopLength),this.stop(!0),this.loop&&(this.loopSource=this.context.createBufferSource(),this.loopSource.buffer=this.loop,this.loopSource.playbackRate.value=this.playbackRate,this.loopSource.loop=!0,this.loopSource.loopStart=0,this.loopSource.loopEnd=this.loopLength,this.loopSource.connect(this.gainNode),t<0&&this.buildup?(this.buildSource=this.context.createBufferSource(),this.buildSource.buffer=this.buildup,this.buildSource.playbackRate.value=this.playbackRate,this.buildSource.connect(this.gainNode),this.buildSource.start(0,this.buildLength+t),this.loopSource.start(this.context.currentTime-t/this.playbackRate)):this.loopSource.start(0,t),this.startTime=this.context.currentTime-t/this.playbackRate,e||(this.playing=!0),this.initVisualiser(),this.core.recalcBeatIndex()))}},{key:"loadSong",value:function(t){if(t._loadPromise)return Promise.reject("Song changed between load and play - this message can be ignored");var e={loop:null,buildup:null},i=[this.loadBuffer(t,"sound").then(function(t){e.loop=t})];return t.buildup?i.push(this.loadBuffer(t,"buildup").then(function(t){e.buildup=t})):this.buildLength=0,t._loadPromise=Promise.all(i).then(function(){return t._loadPromise=null,e}),t._loadPromise}},{key:"loadBuffer",value:function(o,r){var s=this,t=o[r],e=new Uint8Array(t);if(this.oggSupport&&79==e[0]&&103==e[1]&&103==e[2]&&83==e[3]){var i=t.slice(0);return new Promise(function(e,i){s.context.decodeAudioData(t,function(t){e(t)},function(t){i(Error("decodeAudioData failed to load track"))})}).then(function(t){return o[r]=i,t})}return new Promise(function(e,i){var n=s.createWorker();n.addEventListener("error",function(){i(Error("Audio Worker failed to convert track"))},!1),n.addEventListener("message",function(t){t=t.data;n.terminate(),o[r]=t.arrayBuffer,t.error?i(new Error(t.error)):(t=s.audioBufFromRaw(t.rawAudio),e(t))},!1),n.postMessage({buffer:t,ogg:s.oggSupport},[t])})}},{key:"audioBufFromRaw",value:function(t){for(var e=t.array,i=t.channels,n=e.length/i,o=this.context.createBuffer(i,n,t.sampleRate),r=0;r<i;r++){var s=new Float32Array(e.buffer,r*n*4,n);"function"==typeof o.copyToChannel?o.copyToChannel(s,r,0):o.getChannelData(r).set(s)}return o}},{key:"createWorker",value:function(){return new Worker(this.core.settings.workersPath+"audio-worker.js")}},{key:"initVisualiser",value:function(t){t=t||this.vTotalBars,this.vReady=!1,this.vTotalBars=t;for(var e=0;e<this.analysers.length;e++)this.analysers[e].disconnect();this.splitter&&(this.splitter.disconnect(),this.splitter=null),this.analysers=[],this.analyserArrays=[],this.logArrays=[],this.binCutoffs=[],this.linBins=0,this.logBins=0,this.maxBinLin=0,this.attachVisualiser()}},{key:"attachVisualiser",value:function(){if(this.playing&&!this.vReady){var t=this.loopSource.channelCount;this.splitter=this.context.createChannelSplitter(t),this.loopSource.connect(this.splitter),this.buildSource&&this.buildSource.connect(this.splitter),this.vBars=Math.floor(this.vTotalBars/t);for(var e=0;e<t;e++){var i=this.context.createAnalyser();try{i.fftSize=8192}catch(t){i.fftSize=2048}i.smoothingTimeConstant=.6,i.minDecibels=-70,i.maxDecibels=-25,this.analyserArrays.push(new Uint8Array(i.frequencyBinCount)),i.getByteTimeDomainData(this.analyserArrays[e]),this.splitter.connect(i,e),this.analysers.push(i),this.logArrays.push(new Uint8Array(this.vBars))}var n=this.analysers[0].frequencyBinCount,o=this.loopSource.buffer.sampleRate/n;this.maxBinLin=Math.floor(2e3/o),this.linBins=Math.min(this.maxBinLin,Math.floor(this.vBars/2));Math.floor(22e3/o);for(var r=this.vBars-this.linBins,s=Math.log2(2e3),a=Math.log2(22e3)-s,l=0;l<r;l++){var u=l*(a/r)+s,u=Math.pow(2,u),u=Math.floor(u/o);this.binCutoffs.push(u)}this.vReady=!0}}},{key:"sumArray",value:function(t,e,i){for(var n=0,o=e;o<=i;o++)n+=t[o];return n/(i-e+1)}},{key:"getVisualiserData",value:function(){if(!this.vReady)return null;for(var t=0;t<this.analyserArrays.length;t++){var e=this.analyserArrays[t],i=this.logArrays[t];this.analysers[t].getByteFrequencyData(e);for(var n=0;n<this.linBins;n++){var o=Math.round(n*this.maxBinLin/this.linBins);i[n]=e[o]}i[this.linBins]=e[this.binCutoffs[0]];for(var r=this.linBins+1;r<this.vBars;r++){var s=r-this.linBins;i[r]=this.sumArray(e,this.binCutoffs[s-1],this.binCutoffs[s])}}return this.logArrays}},{key:"setMute",value:function(t){return!this.mute&&t&&(this.lastVol=this.gainNode.gain.value),t?this.gainNode.gain.setValueAtTime(0,this.context.currentTime):this.gainNode.gain.setValueAtTime(this.lastVol,this.context.currentTime),this.core.userInterface.updateVolume(this.gainNode.gain.value),this.mute=t}},{key:"toggleMute",value:function(){return this.setMute(!this.mute)}},{key:"decreaseVolume",value:function(){this.setMute(!1);var t=Math.max(this.gainNode.gain.value-.1,0);this.setVolume(t)}},{key:"increaseVolume",value:function(){this.setMute(!1);var t=Math.min(this.gainNode.gain.value+.1,1);this.setVolume(t)}},{key:"setVolume",value:function(t){this.gainNode.gain.setValueAtTime(t,this.context.currentTime),this.lastVol=t,this.core.userInterface.updateVolume(t)}},{key:"fadeOut",value:function(t){this.mute||(this.gainNode.gain.setValueAtTime(this.lastVol,this.context.currentTime),this.gainNode.gain.exponentialRampToValueAtTime(.01,this.context.currentTime+2)),setTimeout(t,2e3)}},{key:"currentTime",get:function(){return this.playing?(this.context.currentTime-this.startTime)*this.playbackRate:0}},{key:"clampedTime",get:function(){var t=this.currentTime;return 0<t&&(t%=this.loopLength),t}}]),i}(),e=atob("T2dnUwACAAAAAAAAAADFYgAAAAAAAMLKRdwBHgF2b3JiaXMAAAAAAUSsAAAAAAAAgLsAAAAAAAC4AU9nZ1MAAAAAAAAAAAAAxWIAAAEAAACcKCV2Dzv/////////////////MgN2b3JiaXMrAAAAWGlwaC5PcmcgbGliVm9yYmlzIEkgMjAxMjAyMDMgKE9tbmlwcmVzZW50KQAAAAABBXZvcmJpcx9CQ1YBAAABABhjVClGmVLSSokZc5QxRplikkqJpYQWQkidcxRTqTnXnGusubUghBAaU1ApBZlSjlJpGWOQKQWZUhBLSSV0EjonnWMQW0nB1phri0G2HIQNmlJMKcSUUopCCBlTjCnFlFJKQgcldA465hxTjkooQbicc6u1lpZji6l0kkrnJGRMQkgphZJKB6VTTkJINZbWUikdc1JSakHoIIQQQrYghA2C0JBVAAABAMBAEBqyCgBQAAAQiqEYigKEhqwCADIAAASgKI7iKI4jOZJjSRYQGrIKAAACABAAAMBwFEmRFMmxJEvSLEvTRFFVfdU2VVX2dV3XdV3XdSA0ZBUAAAEAQEinmaUaIMIMZBgIDVkFACAAAABGKMIQA0JDVgEAAAEAAGIoOYgmtOZ8c46DZjloKsXmdHAi1eZJbirm5pxzzjknm3PGOOecc4pyZjFoJrTmnHMSg2YpaCa05pxznsTmQWuqtOacc8Y5p4NxRhjnnHOatOZBajbW5pxzFrSmOWouxeaccyLl5kltLtXmnHPOOeecc84555xzqhenc3BOOOecc6L25lpuQhfnnHM+Gad7c0I455xzzjnnnHPOOeecc4LQkFUAABAAAEEYNoZxpyBIn6OBGEWIacikB92jwyRoDHIKqUejo5FS6iCUVMZJKZ0gNGQVAAAIAAAhhBRSSCGFFFJIIYUUUoghhhhiyCmnnIIKKqmkoooyyiyzzDLLLLPMMuuws8467DDEEEMMrbQSS0211VhjrbnnnGsO0lpprbXWSimllFJKKQgNWQUAgAAAEAgZZJBBRiGFFFKIIaaccsopqKACQkNWAQCAAAACAAAAPMlzREd0REd0REd0REd0RMdzPEeUREmUREm0TMvUTE8VVdWVXVvWZd32bWEXdt33dd/3dePXhWFZlmVZlmVZlmVZlmVZlmVZgtCQVQAACAAAgBBCCCGFFFJIIaUYY8wx56CTUEIgNGQVAAAIACAAAADAURzFcSRHciTJkixJkzRLszzN0zxN9ERRFE3TVEVXdEXdtEXZlE3XdE3ZdFVZtV1Ztm3Z1m1flm3f933f933f933f933f93UdCA1ZBQBIAADoSI6kSIqkSI7jOJIkAaEhqwAAGQAAAQAoiqM4juNIkiRJlqRJnuVZomZqpmd6qqgCoSGrAABAAAABAAAAAAAomuIppuIpouI5oiNKomVaoqZqriibsuu6ruu6ruu6ruu6ruu6ruu6ruu6ruu6ruu6ruu6ruu6ruu6LhAasgoAkAAA0JEcyZEcSZEUSZEcyQFCQ1YBADIAAAIAcAzHkBTJsSxL0zzN0zxN9ERP9ExPFV3RBUJDVgEAgAAAAgAAAAAAMCTDUixHczRJlFRLtVRNtVRLFVVPVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVNU3TNE0gNGQlAAAEAMBijcHlICElJeXeEMIQk54xJiG1XiEEkZLeMQYVg54yogxy3kLjEIMeCA1ZEQBEAQAAxiDHEHPIOUepkxI556h0lBrnHKWOUmcpxZhizSiV2FKsjXOOUketo5RiLC12lFKNqcYCAAACHAAAAiyEQkNWBABRAACEMUgppBRijDmnnEOMKeeYc4Yx5hxzjjnnoHRSKuecdE5KxBhzjjmnnHNSOieVc05KJ6EAAIAABwCAAAuh0JAVAUCcAIBBkjxP8jRRlDRPFEVTdF1RNF3X8jzV9ExTVT3RVFVTVW3ZVFVZljzPND3TVFXPNFXVVFVZNlVVlkVV1W3TdXXbdFXdlm3b911bFnZRVW3dVF3bN1XX9l3Z9n1Z1nVj8jxV9UzTdT3TdGXVdW1bdV1d90xTlk3XlWXTdW3blWVdd2XZ9zXTdF3TVWXZdF3ZdmVXt11Z9n3TdYXflWVfV2VZGHZd94Vb15XldF3dV2VXN1ZZ9n1b14Xh1nVhmTxPVT3TdF3PNF1XdV1fV13X1jXTlGXTdW3ZVF1ZdmXZ911X1nXPNGXZdF3bNl1Xll1Z9n1XlnXddF1fV2VZ+FVX9nVZ15Xh1m3hN13X91VZ9oVXlnXh1nVhuXVdGD5V9X1TdoXhdGXf14XfWW5dOJbRdX1hlW3hWGVZOX7hWJbd95VldF1fWG3ZGFZZFoZf+J3l9n3jeHVdGW7d58y67wzH76T7ytPVbWOZfd1ZZl93juEYOr/w46mqr5uuKwynLAu/7evGs/u+soyu6/uqLAu/KtvCseu+8/y+sCyj7PrCasvCsNq2Mdy+biy/cBzLa+vKMeu+UbZ1fF94CsPzdHVdeWZdx/Z1dONHOH7KAACAAQcAgAATykChISsCgDgBAI8kiaJkWaIoWZYoiqbouqJouq6kaaapaZ5pWppnmqZpqrIpmq4saZppWp5mmpqnmaZomq5rmqasiqYpy6ZqyrJpmrLsurJtu65s26JpyrJpmrJsmqYsu7Kr267s6rqkWaapeZ5pap5nmqZqyrJpmq6reZ5qep5oqp4oqqpqqqqtqqosW55nmproqaYniqpqqqatmqoqy6aq2rJpqrZsqqptu6rs+rJt67ppqrJtqqYtm6pq267s6rIs27ovaZppap5nmprnmaZpmrJsmqorW56nmp4oqqrmiaZqqqosm6aqypbnmaoniqrqiZ5rmqoqy6Zq2qppmrZsqqotm6Yqy65t+77ryrJuqqpsm6pq66ZqyrJsy77vyqruiqYpy6aq2rJpqrIt27Lvy7Ks+6JpyrJpqrJtqqouy7JtG7Ns+7pomrJtqqYtm6oq27It+7os27rvyq5vq6qs67It+7ru+q5w67owvLJs+6qs+ror27pv6zLb9n1E05RlUzVt21RVWXZl2fZl2/Z90TRtW1VVWzZN1bZlWfZ9WbZtYTRN2TZVVdZN1bRtWZZtYbZl4XZl2bdlW/Z115V1X9d949dl3ea6su3Lsq37qqv6tu77wnDrrvAKAAAYcAAACDChDBQashIAiAIAAIxhjDEIjVLOOQehUco55yBkzkEIIZXMOQghlJI5B6GUlDLnIJSSUgihlJRaCyGUlFJrBQAAFDgAAATYoCmxOEChISsBgFQAAIPjWJbnmaJq2rJjSZ4niqqpqrbtSJbniaJpqqptW54niqapqq7r65rniaJpqqrr6rpomqapqq7ruroumqKpqqrrurKum6aqqq4ru7Ls66aqqqrryq4s+8Kquq4ry7Jt68Kwqq7ryrJs27Zv3Lqu677v+8KRreu6LvzCMQxHAQDgCQ4AQAU2rI5wUjQWWGjISgAgAwCAMAYhgxBCBiGEkFJKIaWUEgAAMOAAABBgQhkoNGRFABAnAAAYQymklFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSCmllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSqmklFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimVUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFIKAJCKcACQejChDBQashIASAUAAIxRSinGnIMQMeYYY9BJKClizDnGHJSSUuUchBBSaS23yjkIIaTUUm2Zc1JaizHmGDPnpKQUW805h1JSi7HmmmvupLRWa64151paqzXXnHPNubQWa64515xzyzHXnHPOOecYc84555xzzgUA4DQ4AIAe2LA6wknRWGChISsBgFQAAAIZpRhzzjnoEFKMOecchBAihRhzzjkIIVSMOeccdBBCqBhzzDkIIYSQOecchBBCCCFzDjroIIQQQgcdhBBCCKGUzkEIIYQQSighhBBCCCGEEDoIIYQQQgghhBBCCCGEUkoIIYQQQgmhlFAAAGCBAwBAgA2rI5wUjQUWGrISAAACAIAclqBSzoRBjkGPDUHKUTMNQkw50ZliTmozFVOQORCddBIZakHZXjILAACAIAAgwAQQGCAo+EIIiDEAAEGIzBAJhVWwwKAMGhzmAcADRIREAJCYoEi7uIAuA1zQxV0HQghCEIJYHEABCTg44YYn3vCEG5ygU1TqIAAAAAAADADgAQDgoAAiIpqrsLjAyNDY4OjwCAAAAAAAFgD4AAA4PoCIiOYqLC4wMjQ2ODo8AgAAAAAAAAAAgICAAAAAAABAAAAAgIBPZ2dTAAQBAAAAAAAAAMViAAACAAAA22A/JwIBAQAK"),n=new ArrayBuffer(e.length),i=new Uint8Array(n),o=0;o<e.length;o++)i[o]=e.charCodeAt(o);r.SoundManager=t}(window,document);
"use strict";String.prototype.score=function(t,e){if(this===t)return 1;if(""===t)return 0;var r,i,s,n=0,o=this.toLowerCase(),f=this.length,h=t.toLowerCase(),u=t.length,a=0,c=1;if(e&&(i=1-e),e)for(s=0;s<u;s+=1)-1===(r=o.indexOf(h[s],a))?c+=i:(a===r?a=.7:(a=.1," "===this[r-1]&&(a+=.8)),this[r]===t[s]&&(a+=.1),n+=a,a=r+1);else for(s=0;s<u;s+=1){if(-1===(r=o.indexOf(h[s],a)))return 0;a===r?a=.7:(a=.1," "===this[r-1]&&(a+=.8)),this[r]===t[s]&&(a+=.1),n+=a,a=r+1}return n=.5*(n/f+n/u)/c,h[0]===o[0]&&n<.85&&(n+=.15),n};
//# sourceMappingURL=hues-min.js.map
