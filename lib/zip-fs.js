!function(){"use strict";var u=524288,r=zip.TextWriter,f=zip.BlobWriter,o=zip.Data64URIWriter,t=zip.Reader,n=zip.TextReader,p=zip.BlobReader,a=zip.Data64URIReader,c=zip.createReader,s=zip.createWriter;function d(o){var a,c=this;c.size=0,c.init=function(t){c.size=o.uncompressedSize,t()},c.readUint8Array=function(t,i,e,n){var r;r=function(){a.readUint8Array(t,i,e,n)},c.data?r():o.getData(new f,function(t){c.data=t,a=new p(t),r()},null,c.checkCrc32)}}function h(t){var e=0;return function t(i){e+=i.uncompressedSize||0,i.children.forEach(t)}(t),e}function l(t,i,e){var n=0;function r(){++n<t.children.length?o(t.children[n]):i()}function o(t){t.directory?l(t,r,e):(t.reader=new t.Reader(t.data,e),t.reader.init(function(){t.uncompressedSize=t.reader.size,r()}))}t.children.length?o(t.children[n]):i()}function e(e){var n=e.parent.children;n.forEach(function(t,i){t.id==e.id&&n.splice(i,1)})}function y(t,i,e,n,r){var u=0;function f(e,n,r,o,a){var c=0;!function t(){var i=n.children[c];i?e.add(i.getFullname(),i.reader,function(){u+=i.uncompressedSize||0,f(e,i,function(){c++,t()},o,a)},function(t){o&&o(u+t,a)},{directory:i.directory,version:i.zipVersion}):r()}()}f(t,i,e,n,r)}function m(i,e,n,f){e.isDirectory?function a(c,t,u){var i;i=function(i){var r=0;function o(){var e,t=i[r];function n(t){a(t,e,function(){r++,o()})}t?((e=t).isDirectory&&n(c.addDirectory(e.name)),e.isFile&&e.file(function(t){var i=c.addBlob(e.name,t);i.uncompressedSize=t.size,n(i)},f)):u()}o()},t.isDirectory&&t.createReader().readEntries(i),t.isFile&&i([])}(i,e,n):e.file(function(t){i.addBlob(e.name,t),n()},f)}function g(t,i,e,n,r,o,d){var h=0;i.directory?function n(r,o,a,c,u,f){var p=0;function s(){var i,t=o.children[p];function e(t){h+=i.uncompressedSize||0,n(t,i,function(){p++,s()},c,u,f)}t?(i=t).directory?r.getDirectory(i.name,{create:!0},e,u):r.getFile(i.name,{create:!0},function(t){i.getData(new zip.FileWriter(t,zip.getMimeType(i.name)),e,function(t){c&&c(h+t,f)},d)},u):a()}s()}(t,i,e,n,r,o):i.getData(new zip.FileWriter(t,zip.getMimeType(i.name)),e,n,d)}function z(t){t.entries=[],t.root=new R(t)}function v(e,n,r,o,a){var c=0;!function i(){var t=c*u;o&&o(t,e.size),t<e.size?e.readUint8Array(t,Math.min(u,e.size-t),function(t){n.writeUint8Array(new Uint8Array(t),function(){c++,i()})},a):n.getData(r)}()}function D(t,i,e,n){if(t.directory)return new(n?R:x)(t.fs,i,e,t);throw"Parent entry is not a directory."}function w(){}function x(t,i,e,n){var r=this;w.prototype.init.call(r,t,i,e,n),r.Reader=e.Reader,r.Writer=e.Writer,r.data=e.data,e.getData&&(r.getData=e.getData)}function R(t,i,e,n){w.prototype.init.call(this,t,i,e,n),this.directory=!0}function i(){z(this)}((d.prototype=new t).constructor=d).prototype.checkCrc32=!1,x.prototype=t=new((w.prototype={init:function(t,i,e,n){var r=this;if(t.root&&n&&n.getChildByName(i))throw"Entry filename already exists.";e=e||{},r.fs=t,r.name=i,r.id=t.entries.length,r.parent=n,r.children=[],r.zipVersion=e.zipVersion||20,r.uncompressedSize=0,t.entries.push(r),n&&r.parent.children.push(r)},getFileEntry:function(t,i,e,n,r){var o=this;l(o,function(){g(t,o,i,e,n,h(o),r)},n)},moveTo:function(t){var i=this;if(!t.directory)throw"Target entry is not a directory.";if(t.isDescendantOf(i))throw"Entry is a ancestor of target entry.";if(i!=t){if(t.getChildByName(i.name))throw"Entry filename already exists.";e(i),(i.parent=t).children.push(i)}},getFullname:function(){for(var t=this.name,i=this.parent;i;)t=(i.name?i.name+"/":"")+t,i=i.parent;return t},isDescendantOf:function(t){for(var i=this.parent;i&&i.id!=t.id;)i=i.parent;return!!i}}).constructor=w),t.constructor=x,t.getData=function(t,i,e,n){var r=this;!t||t.constructor==r.Writer&&r.data?i(r.data):(r.reader||(r.reader=new r.Reader(r.data,n)),r.reader.init(function(){t.init(function(){v(r.reader,t,i,e,n)},n)}))},t.getText=function(t,i,e,n){this.getData(new r(n),t,i,e)},t.getBlob=function(t,i,e,n){this.getData(new f(t),i,e,n)},t.getData64URI=function(t,i,e,n){this.getData(new o(t),i,e,n)},R.prototype=t=new w,t.constructor=R,t.addDirectory=function(t){return D(this,t,null,!0)},t.addText=function(t,i){return D(this,t,{data:i,Reader:n,Writer:r})},t.addBlob=function(t,i){return D(this,t,{data:i,Reader:p,Writer:f})},t.addData64URI=function(t,i){return D(this,t,{data:i,Reader:a,Writer:o})},t.addFileEntry=function(t,i,e){m(this,t,i,e)},t.addData=function(t,i){return D(this,t,i)},t.importBlob=function(t,i,e){this.importZip(new p(t),i,e)},t.importText=function(t,i,e){this.importZip(new n(t),i,e)},t.importData64URI=function(t,i,e){this.importZip(new a(t),i,e)},t.exportBlob=function(t,i,e){this.exportZip(new f("application/zip"),t,i,e)},t.exportText=function(t,i,e){this.exportZip(new r,t,i,e)},t.exportFileEntry=function(t,i,e,n){this.exportZip(new zip.FileWriter(t,"application/zip"),i,e,n)},t.exportData64URI=function(t,i,e){this.exportZip(new o("application/zip"),t,i,e)},t.importZip=function(t,i,e){var r=this;c(t,function(t){t.getEntries(function(t){t.forEach(function(t){var i=r,e=t.filename.split("/"),n=e.pop();e.forEach(function(t){i=i.getChildByName(t)||new R(r.fs,t,null,i)}),t.directory||D(i,n,{data:t,Reader:d})}),i()})},e)},t.exportZip=function(t,i,e,n){var r=this;l(r,function(){s(t,function(t){y(t,r,function(){t.close(i)},e,h(r))},n)},n)},t.getChildByName=function(t){for(var i,e=0;e<this.children.length;e++)if((i=this.children[e]).name==t)return i},i.prototype={remove:function(t){e(t),this.entries[t.id]=null},find:function(t){for(var i=t.split("/"),e=this.root,n=0;e&&n<i.length;n++)e=e.getChildByName(i[n]);return e},getById:function(t){return this.entries[t]},importBlob:function(t,i,e){z(this),this.root.importBlob(t,i,e)},importText:function(t,i,e){z(this),this.root.importText(t,i,e)},importData64URI:function(t,i,e){z(this),this.root.importData64URI(t,i,e)},exportBlob:function(t,i,e){this.root.exportBlob(t,i,e)},exportText:function(t,i,e){this.root.exportText(t,i,e)},exportFileEntry:function(t,i,e,n){this.root.exportFileEntry(t,i,e,n)},exportData64URI:function(t,i,e){this.root.exportData64URI(t,i,e)}},zip.fs={FS:i,ZipDirectoryEntry:R,ZipFileEntry:x},zip.getMimeType=function(){return"application/octet-stream"}}();